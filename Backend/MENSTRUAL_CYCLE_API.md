# Menstrual Cycle API Documentation

## Tá»•ng quan

API quáº£n lÃ½ chu ká»³ kinh nguyá»‡t theo phÆ°Æ¡ng phÃ¡p Billings, bao gá»“m theo dÃµi 3 chu ká»³, phÃ¢n tÃ­ch dá»¯ liá»‡u, vÃ  gá»­i nháº¯c nhá»Ÿ hÃ ng ngÃ y.

**ğŸšº LÆ°u Ã½ quan trá»ng:** TÃ­nh nÄƒng chu ká»³ kinh nguyá»‡t chá»‰ dÃ nh cho ngÆ°á»i dÃ¹ng ná»¯ (`gender: 'female'`). Há»‡ thá»‘ng sáº½ tá»± Ä‘á»™ng kiá»ƒm tra vÃ  chá»‰ gá»­i nháº¯c nhá»Ÿ email cho user ná»¯ cÃ³ chu ká»³ kinh nguyá»‡t.

## Authentication

Táº¥t cáº£ endpoints Ä‘á»u yÃªu cáº§u JWT token trong header `Authorization: Bearer <token>`, trá»« endpoint trigger reminder.

## API Endpoints

### 1. Quáº£n lÃ½ Chu ká»³ (Menstrual Cycles)

#### Táº¡o chu ká»³ má»›i
```http
POST /api/menstrual-cycles
Content-Type: application/json
Authorization: Bearer <token>

{
  "startDate": "2024-01-01"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Táº¡o chu ká»³ má»›i thÃ nh cÃ´ng",
  "data": {
    "_id": "cycle_id",
    "createdByUserId": "user_id",
    "startDate": "2024-01-01T00:00:00.000Z",
    "cycleNumber": 1,
    "status": "tracking",
    "isCompleted": false
  }
}
```

#### Láº¥y danh sÃ¡ch chu ká»³
```http
GET /api/menstrual-cycles?page=1&limit=10&status=tracking
Authorization: Bearer <token>
```

**Response:**
```json
{
  "success": true,
  "data": {
    "cycles": [...],
    "pagination": {
      "current": 1,
      "total": 5,
      "totalRecords": 42
    }
  }
}
```

#### Láº¥y chi tiáº¿t chu ká»³
```http
GET /api/menstrual-cycles/:id
Authorization: Bearer <token>
```

#### Láº¥y dá»¯ liá»‡u calendar
```http
GET /api/menstrual-cycles/calendar?month=1&year=2024
Authorization: Bearer <token>
```

**Response:**
```json
{
  "success": true,
  "data": {
    "month": 1,
    "year": 2024,
    "days": [
      {
        "date": "2024-01-01T00:00:00.000Z",
        "symbol": "M",
        "isPeakDay": false,
        "fertilityProbability": 0,
        "mucusObservation": "cÃ³ mÃ¡u",
        "feeling": "Æ°á»›t",
        "notes": "NgÃ y Ä‘áº§u chu ká»³",
        "isValidated": true,
        "warning": null
      }
    ]
  }
}
```

#### Cáº­p nháº­t chu ká»³
```http
PUT /api/menstrual-cycles/:id
Content-Type: application/json
Authorization: Bearer <token>

{
  "startDate": "2024-01-05",  // Cáº­p nháº­t ngÃ y báº¯t Ä‘áº§u chu ká»³ (tÃ¹y chá»n)
  "endDate": "2024-01-28",    // NgÃ y káº¿t thÃºc chu ká»³ (tÃ¹y chá»n)
  "isCompleted": true,        // ÄÃ¡nh dáº¥u chu ká»³ hoÃ n thÃ nh (tÃ¹y chá»n)
  "status": "completed"       // Tráº¡ng thÃ¡i: "tracking", "completed", "analysis" (tÃ¹y chá»n)
}
```

**LÆ°u Ã½ quan trá»ng vá» startDate:**
- Khi cáº­p nháº­t `startDate`, há»‡ thá»‘ng sáº½ tá»± Ä‘á»™ng tÃ­nh toÃ¡n láº¡i `cycleDayNumber` cho táº¥t cáº£ ngÃ y Ä‘Ã£ ghi nháº­n trong chu ká»³
- Äiá»u nÃ y há»¯u Ã­ch khi phÃ¡t hiá»‡n ngÃ y Ä‘áº§u kinh nguyá»‡t thá»±c táº¿ khÃ¡c vá»›i ngÃ y Ä‘Ã£ Ä‘áº·t ban Ä‘áº§u
- VÃ­ dá»¥: Náº¿u báº¡n Ä‘áº·t ngÃ y báº¯t Ä‘áº§u lÃ  15/1 nhÆ°ng sau Ä‘Ã³ nháº­n ra ngÃ y 12/1 má»›i lÃ  ngÃ y Ä‘áº§u tháº­t sá»±

**Response:**
```json
{
  "success": true,
  "message": "Cáº­p nháº­t chu ká»³ thÃ nh cÃ´ng",
  "data": {
    "_id": "cycle_id",
    "createdByUserId": "user_id",
    "startDate": "2024-01-05T00:00:00.000Z",
    "endDate": "2024-01-28T00:00:00.000Z",
    "isCompleted": true,
    "status": "completed"
  }
}
```

### 2. Quáº£n lÃ½ NgÃ y trong Chu ká»³ (Cycle Days)

#### ThÃªm/cáº­p nháº­t dá»¯ liá»‡u ngÃ y
```http
POST /api/cycle-days
Content-Type: application/json
Authorization: Bearer <token>

{
  "cycleId": "cycle_id",
  "date": "2024-01-15",
  "mucusObservation": "trong vÃ  Ã¢m há»™ cÄƒng",
  "feeling": "trÆ¡n",
  "notes": "Cáº£m giÃ¡c cÃ³ thá»ƒ lÃ  ngÃ y X"
}
```

**Mucus Observations:**
- `cÃ³ mÃ¡u`
- `láº¥m táº¥m mÃ¡u`
- `Ä‘á»¥c`
- `Ä‘á»¥c nhiá»u sá»£i`
- `trong nhiá»u sá»£i`
- `trong vÃ  Ã¢m há»™ cÄƒng` (ngÃ y X)
- `dáº§y`
- `Ã­t cháº¥t tiáº¿t`

**Feelings:**
- `Æ°á»›t`
- `dÃ­nh`
- `áº©m`
- `khÃ´`
- `trÆ¡n`

**Response:**
```json
{
  "success": true,
  "message": "Cáº­p nháº­t dá»¯ liá»‡u ngÃ y thÃ nh cÃ´ng",
  "data": {
    "_id": "day_id",
    "cycleId": "cycle_id",
    "date": "2024-01-15T00:00:00.000Z",
    "mucusObservation": "trong vÃ  Ã¢m há»™ cÄƒng",
    "feeling": "trÆ¡n",
    "isPeakDay": true,
    "peakDayRelative": 0,
    "fertilityProbability": 100,
    "isValidated": true,
    "isAutoGenerated": false,
    "cycleDayNumber": 15,
    "month": 1,
    "year": 2024
  }
}
```

#### XÃ³a dá»¯ liá»‡u ngÃ y
```http
DELETE /api/cycle-days/:id
Authorization: Bearer <token>
```

### 3. BÃ¡o cÃ¡o vÃ  PhÃ¢n tÃ­ch

#### Táº¡o bÃ¡o cÃ¡o chu ká»³
```http
POST /api/reports/generate/:cycleId
Authorization: Bearer <token>
```

**Response:**
```json
{
  "success": true,
  "message": "Táº¡o bÃ¡o cÃ¡o chu ká»³ thÃ nh cÃ´ng",
  "data": {
    "_id": "report_id",
    "cycleId": "cycle_id",
    "x": "2024-01-15T00:00:00.000Z",
    "xPlusOne": "2024-01-16T00:00:00.000Z",
    "y": "2024-01-28T00:00:00.000Z",
    "result": -12,
    "resultType": "normal",
    "analysis": {
      "peakDayDetected": true,
      "postPeakDaysAnalyzed": 3,
      "fertilityWindowStart": "2024-01-13T00:00:00.000Z",
      "fertilityWindowEnd": "2024-01-18T00:00:00.000Z"
    }
  }
}
```

#### Láº¥y bÃ¡o cÃ¡o chu ká»³
```http
GET /api/reports/:cycleId
Authorization: Bearer <token>
```

#### So sÃ¡nh 3 chu ká»³
```http
GET /api/reports/comparison
Authorization: Bearer <token>
```

### 4. PhÃ¢n tÃ­ch Chu ká»³ HoÃ n chá»‰nh (Cycle Analysis)

#### Láº¥y bÃ¡o cÃ¡o phÃ¢n tÃ­ch chu ká»³
```http
GET /api/menstrual-cycles/:id/analysis
Authorization: Bearer <token>
```

**Response:**
```json
{
  "success": true,
  "message": "Láº¥y bÃ¡o cÃ¡o phÃ¢n tÃ­ch chu ká»³ thÃ nh cÃ´ng",
  "data": {
    "cycleId": "cycle_id",
    "cycleNumber": 1,
    "startDate": "2024-01-01T00:00:00.000Z",
    "endDate": null,
    "isCompleted": false,
    "analysis": {
      "isComplete": false,
      "analysis": "ÄÃ£ cÃ³ kinh nguyá»‡t, Ä‘ang chá» ngÃ y Ä‘á»‰nh (trong vÃ  Ã¢m há»™ cÄƒng).",
      "phase": "pre_peak_tracking",
      "peakDay": null,
      "pattern": {
        "type": "unknown_pattern",
        "name": "Máº«u chÆ°a rÃµ rÃ ng",
        "description": "Cáº§n thÃªm dá»¯ liá»‡u Ä‘á»ƒ phÃ¢n tÃ­ch",
        "confidence": "unknown"
      },
      "nextPeakPrediction": {
        "prediction": null,
        "confidence": "none",
        "message": "ChÆ°a xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c ngÃ y Ä‘á»‰nh cá»§a chu ká»³ hiá»‡n táº¡i"
      },
      "recommendations": [
        "ğŸ“ˆ Cáº§n thÃªm dá»¯ liá»‡u Ä‘á»ƒ phÃ¢n tÃ­ch chu ká»³",
        "ğŸ¯ HÃ£y ghi nháº­n Ä‘áº§y Ä‘á»§ thÃ´ng tin má»—i ngÃ y"
      ]
    }
  }
}
```

**CÃ¡c loáº¡i máº«u chu ká»³ (Pattern Types):**
- `normal_pattern`: Chu ká»³ bÃ¬nh thÆ°á»ng (MÃ¡u â†’ Láº¥m táº¥m mÃ¡u â†’ KhÃ´ â†’ Äá»¥c â†’ Trong Ã¢m há»™ cÄƒng)
- `irregular_pattern`: Chu ká»³ cáº§n theo dÃµi (Láº¥m táº¥m mÃ¡u â†’ Ãt cháº¥t tiáº¿t)
- `unknown_pattern`: Máº«u chÆ°a rÃµ rÃ ng

**CÃ¡c giai Ä‘oáº¡n chu ká»³ (Phases):**
- `no_data`: ChÆ°a cÃ³ dá»¯ liá»‡u
- `initial_tracking`: Äang theo dÃµi ban Ä‘áº§u
- `pre_peak_tracking`: ÄÃ£ cÃ³ kinh nguyá»‡t, chá» ngÃ y Ä‘á»‰nh
- `post_peak_tracking`: ÄÃ£ qua ngÃ y Ä‘á»‰nh, chá» ngÃ y khÃ´
- `completed`: Chu ká»³ hoÃ n chá»‰nh
- `needs_observation`: Cáº§n theo dÃµi thÃªm

#### Tá»± Ä‘á»™ng hoÃ n thÃ nh chu ká»³
```http
POST /api/menstrual-cycles/:id/auto-complete
Authorization: Bearer <token>
```

#### Láº¥y hÆ°á»›ng dáº«n chi tiáº¿t vá» chu ká»³ hiá»‡n táº¡i
```http
GET /api/menstrual-cycles/:id/guidance
Authorization: Bearer <token>
```

**Response:**
```json
{
  "success": true,
  "message": "Láº¥y hÆ°á»›ng dáº«n chu ká»³ thÃ nh cÃ´ng",
  "data": {
    "cycleId": "cycle_id",
    "cycleNumber": 1,
    "startDate": "2024-01-01T00:00:00.000Z",
    "isCompleted": false,
    "currentPhase": "post_peak_tracking",
    "analysis": "ÄÃ£ qua ngÃ y Ä‘á»‰nh. Cáº§n theo dÃµi thÃªm 2 ngÃ y Ä‘á»ƒ hoÃ n thÃ nh chu ká»³.",
    "status": "critical",
    "title": "â° Äang theo dÃµi sau ngÃ y Ä‘á»‰nh",
    "description": "ÄÃ£ qua ngÃ y Ä‘á»‰nh. Cáº§n theo dÃµi thÃªm 2 ngÃ y Ä‘á»ƒ hoÃ n thÃ nh chu ká»³.",
    "peakDay": "2024-01-14T00:00:00.000Z",
    "actions": [
      {
        "type": "continue",
        "text": "Tiáº¿p tá»¥c ghi nháº­n 2 ngÃ y ná»¯a",
        "priority": "high"
      },
      {
        "type": "observe",
        "text": "ChÃº Ã½ sá»± chuyá»ƒn Ä‘á»•i sang tráº¡ng thÃ¡i khÃ´",
        "priority": "medium"
      }
    ],
    "tips": [
      "ÄÃ¢y lÃ  giai Ä‘oáº¡n quan trá»ng Ä‘á»ƒ xÃ¡c Ä‘á»‹nh chu ká»³ hoÃ n chá»‰nh",
      "Ghi nháº­n chÃ­nh xÃ¡c cáº£m giÃ¡c \"khÃ´\" hoáº·c \"Ã­t cháº¥t tiáº¿t\"",
      "KhÃ´ng bá» sÃ³t báº¥t ká»³ ngÃ y nÃ o trong giai Ä‘oáº¡n nÃ y"
    ]
  }
}
```

**Response khi chu ká»³ Ä‘á»§ Ä‘iá»u kiá»‡n:**
```json
{
  "success": true,
  "message": "Chu ká»³ Ä‘Ã£ Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u hoÃ n thÃ nh",
  "data": {
    "cycle": {
      "_id": "cycle_id",
      "isCompleted": true,
      "status": "completed",
      "peakDay": "2024-01-15T00:00:00.000Z"
    },
    "analysis": {
      "isComplete": true,
      "analysis": "Chu ká»³ hoÃ n chá»‰nh. NgÃ y Ä‘á»‰nh: 15. Thá»i gian khÃ´ sau Ä‘á»‰nh: 3 ngÃ y."
    }
  }
}
```

**Response khi chu ká»³ chÆ°a Ä‘á»§ Ä‘iá»u kiá»‡n:**
```json
{
  "success": false,
  "message": "Chu ká»³ chÆ°a Ä‘á»§ Ä‘iá»u kiá»‡n Ä‘á»ƒ hoÃ n thÃ nh",
  "data": {
    "analysis": {
      "isComplete": false,
      "phase": "post_peak_tracking",
      "analysis": "ÄÃ£ qua ngÃ y Ä‘á»‰nh (ngÃ y 15). Cáº§n theo dÃµi thÃªm 1 ngÃ y khÃ´ Ä‘á»ƒ hoÃ n thÃ nh chu ká»³."
    }
  }
}
```

## Logic PhÃ¢n tÃ­ch Chu ká»³ theo PhÆ°Æ¡ng phÃ¡p Billings - Cáº¬P NHáº¬T Má»šI

### Äá»‹nh nghÄ©a Chu ká»³ HoÃ n chá»‰nh

Má»™t chu ká»³ kinh nguyá»‡t Ä‘Æ°á»£c coi lÃ  **hoÃ n chá»‰nh** khi cÃ³ Ä‘áº§y Ä‘á»§ cÃ¡c giai Ä‘oáº¡n theo Ä‘Ãºng trÃ¬nh tá»±:

1. **Báº¯t Ä‘áº§u**: Cáº£m giÃ¡c cháº¥t nhá»n lÃ  mÃ¡u (`cÃ³ mÃ¡u`)
2. **TÃ¹y chá»n**: Láº¥m táº¥m mÃ¡u 
3. **NgÃ y Ä‘á»‰nh**: Cáº£m giÃ¡c cháº¥t nhá»n lÃ  `trong vÃ  Ã¢m há»™ cÄƒng` + cáº£m giÃ¡c `trÆ¡n`
4. **Káº¿t thÃºc**: Cáº£m giÃ¡c cháº¥t nhá»n lÃ  khÃ´ (`khÃ´` hoáº·c `Ã­t cháº¥t tiáº¿t`) sau Ã­t nháº¥t 3 ngÃ y sau Ä‘á»‰nh

### Hai TrÆ°á»ng há»£p HoÃ n thÃ nh Chu ká»³

#### **TrÆ°á»ng há»£p 1: HoÃ n thÃ nh trong cÃ¹ng thÃ¡ng**
```
Diá»…n biáº¿n: MÃ¡u â†’ [Láº¥m táº¥m] â†’ KhÃ´ â†’ Äá»¥c â†’ NgÃ y Ä‘á»‰nh â†’ 3 ngÃ y sau Ä‘á»‰nh khÃ´ â†’ MÃ¡u má»›i
Thá»i gian: Táº¥t cáº£ diá»…n ra trong 1 thÃ¡ng
Äiá»u kiá»‡n: Sau ngÃ y 1,2,3 sau ngÃ y Ä‘á»‰nh lÃ  khÃ´ â†’ cÃ³ mÃ¡u chu ká»³ má»›i
```

**VÃ­ dá»¥:**
- NgÃ y 1-5: CÃ³ mÃ¡u kinh nguyá»‡t
- NgÃ y 6-7: Láº¥m táº¥m mÃ¡u (optional)
- NgÃ y 8-10: KhÃ´ (`Ã­t cháº¥t tiáº¿t`, `khÃ´`)
- NgÃ y 11-12: Äá»¥c
- NgÃ y 14: NgÃ y Ä‘á»‰nh (`trong vÃ  Ã¢m há»™ cÄƒng`, `trÆ¡n`)
- NgÃ y 15-17: 3 ngÃ y sau Ä‘á»‰nh (ngÃ y 17 = khÃ´)
- NgÃ y 18-28: Tiáº¿p tá»¥c khÃ´
- **NgÃ y 29: MÃ¡u má»›i â†’ CHU Ká»² HOÃ€N CHá»ˆNH**

#### **TrÆ°á»ng há»£p 2: Láº¥n sang thÃ¡ng sau**
```
Diá»…n biáº¿n: MÃ¡u â†’ [Láº¥m táº¥m] â†’ KhÃ´ â†’ Äá»¥c â†’ NgÃ y Ä‘á»‰nh â†’ 3 ngÃ y sau Ä‘á»‰nh váº«n Ã­t cháº¥t tiáº¿t
Thá»i gian: Láº¥n sang thÃ¡ng sau do chÆ°a chuyá»ƒn sang khÃ´ hoÃ n toÃ n
Äiá»u kiá»‡n: Sau ngÃ y 1,2,3 sau ngÃ y Ä‘á»‰nh váº«n Ã­t cháº¥t tiáº¿t, chÆ°a chuyá»ƒn sang khÃ´
```

**VÃ­ dá»¥:**
- NgÃ y 15-17 thÃ¡ng 1: CÃ³ mÃ¡u kinh nguyá»‡t
- NgÃ y 18-19 thÃ¡ng 1: Láº¥m táº¥m mÃ¡u
- NgÃ y 20-21 thÃ¡ng 1: KhÃ´
- NgÃ y 22-23 thÃ¡ng 1: Äá»¥c
- NgÃ y 26 thÃ¡ng 1: NgÃ y Ä‘á»‰nh
- NgÃ y 27-31 thÃ¡ng 1: 3 ngÃ y sau Ä‘á»‰nh váº«n `Ã­t cháº¥t tiáº¿t`
- **NgÃ y 1-5 thÃ¡ng 2: Váº«n `Ã­t cháº¥t tiáº¿t`, chÆ°a khÃ´ hoÃ n toÃ n**
- **Cáº§n theo dÃµi thÃªm Ä‘áº¿n khi chuyá»ƒn sang khÃ´**

### API Response má»›i

#### Khi chu ká»³ hoÃ n chá»‰nh (TrÆ°á»ng há»£p 1):
```json
{
  "success": true,
  "message": "Chu ká»³ Ä‘Ã£ hoÃ n thÃ nh vÃ  tá»± Ä‘á»™ng táº¡o chu ká»³ má»›i",
  "data": {
    "completedCycle": {
      "_id": "cycle_id",
      "isCompleted": true,
      "status": "completed",
      "endDate": "2024-01-28T00:00:00.000Z"
    },
    "newCycle": {
      "_id": "new_cycle_id",
      "startDate": "2024-01-29T00:00:00.000Z",
      "cycleNumber": 2
    },
    "analysis": {
      "isComplete": true,
      "phase": "completed_case_1",
      "analysis": "Chu ká»³ hoÃ n chá»‰nh (TrÆ°á»ng há»£p 1 - trong cÃ¹ng thÃ¡ng). NgÃ y Ä‘á»‰nh: 14/1/2024. Chu ká»³ dÃ i 28 ngÃ y.",
      "cycleType": "same_month_completion",
      "cycleLength": 28,
      "nextCycleStart": "2024-01-29T00:00:00.000Z"
    }
  }
}
```

#### Khi chu ká»³ chÆ°a hoÃ n chá»‰nh (TrÆ°á»ng há»£p 2):
```json
{
  "success": false,
  "message": "Chu ká»³ chÆ°a Ä‘á»§ Ä‘iá»u kiá»‡n Ä‘á»ƒ hoÃ n thÃ nh",
  "data": {
    "analysis": {
      "isComplete": false,
      "phase": "cross_month_drying",
      "analysis": "TrÆ°á»ng há»£p 2 - Láº¥n sang thÃ¡ng sau. NgÃ y 3 sau Ä‘á»‰nh váº«n cÃ³ Ã­t cháº¥t tiáº¿t. Cáº§n tiáº¿p tá»¥c theo dÃµi Ä‘áº¿n khi chuyá»ƒn sang tráº¡ng thÃ¡i khÃ´.",
      "cycleType": "cross_month_incomplete",
      "peakDay": {
        "date": "2024-01-26T00:00:00.000Z",
        "cycleDayNumber": 12
      }
    },
    "phase": "cross_month_drying",
    "guidance": "Chu ká»³ Ä‘Ã£ láº¥n sang thÃ¡ng sau. Tiáº¿p tá»¥c theo dÃµi cho Ä‘áº¿n khi hoÃ n toÃ n khÃ´.",
    "currentStatus": "TrÆ°á»ng há»£p 2 - Láº¥n sang thÃ¡ng sau. NgÃ y 3 sau Ä‘á»‰nh váº«n cÃ³ Ã­t cháº¥t tiáº¿t."
  }
}
```

### CÃ¡c Giai Ä‘oáº¡n Chu ká»³ Má»›i

| Giai Ä‘oáº¡n | MÃ´ táº£ | HÃ nh Ä‘á»™ng |
|-----------|-------|-----------|
| `waiting_for_menstruation` | ChÆ°a cÃ³ mÃ¡u kinh nguyá»‡t | Ghi nháº­n ngÃ y Ä‘áº§u cÃ³ mÃ¡u |
| `pre_peak_tracking` | ÄÃ£ cÃ³ mÃ¡u, chá» ngÃ y Ä‘á»‰nh | Theo dÃµi Ä‘áº¿n khi cÃ³ `trong vÃ  Ã¢m há»™ cÄƒng` |
| `post_peak_tracking` | Sau ngÃ y Ä‘á»‰nh, chá» Ä‘á»§ 3 ngÃ y | Theo dÃµi thÃªm X ngÃ y |
| `waiting_for_next_menstruation` | ÄÃ£ khÃ´ 3 ngÃ y, chá» mÃ¡u má»›i | Chá» kinh nguyá»‡t chu ká»³ tiáº¿p theo |
| `cross_month_drying` | Láº¥n sang thÃ¡ng, Ä‘Ã£ tÃ¬m tháº¥y ngÃ y khÃ´ | Theo dÃµi thÃªm Ä‘á»ƒ xÃ¡c nháº­n |
| `extended_post_peak_tracking` | Láº¥n sang thÃ¡ng, váº«n chÆ°a khÃ´ | Tiáº¿p tá»¥c theo dÃµi Ä‘áº¿n khi khÃ´ |
| `completed_case_1` | âœ… HoÃ n thÃ nh TrÆ°á»ng há»£p 1 | Tá»± Ä‘á»™ng táº¡o chu ká»³ má»›i |
| `completed_case_2` | âœ… HoÃ n thÃ nh TrÆ°á»ng há»£p 2 | ÄÃ¡nh dáº¥u hoÃ n thÃ nh |

### HÆ°á»›ng dáº«n Sá»­ dá»¥ng

1. **Theo dÃµi hÃ ng ngÃ y**: Ghi nháº­n Ä‘áº§y Ä‘á»§ `mucusObservation` vÃ  `feeling` má»—i ngÃ y

2. **Kiá»ƒm tra tráº¡ng thÃ¡i**: Gá»i API `GET /api/menstrual-cycles/:id/analysis` Ä‘á»ƒ xem tráº¡ng thÃ¡i hiá»‡n táº¡i

3. **Tá»± Ä‘á»™ng hoÃ n thÃ nh**: Gá»i API `POST /api/menstrual-cycles/:id/auto-complete` khi muá»‘n kiá»ƒm tra Ä‘iá»u kiá»‡n hoÃ n thÃ nh

4. **Xá»­ lÃ½ TrÆ°á»ng há»£p 2**: Khi chu ká»³ láº¥n sang thÃ¡ng sau, tiáº¿p tá»¥c theo dÃµi cho Ä‘áº¿n khi hoÃ n toÃ n khÃ´

### Quy táº¯c Validation Quan trá»ng

- **NgÃ y Ä‘á»‰nh**: Pháº£i cÃ³ `mucusObservation = "trong vÃ  Ã¢m há»™ cÄƒng"` + `feeling = "trÆ¡n"`
- **3 ngÃ y sau Ä‘á»‰nh**: Pháº£i cÃ³ Ã­t nháº¥t 3 ngÃ y liÃªn tiáº¿p sau ngÃ y Ä‘á»‰nh
- **NgÃ y khÃ´**: `feeling = "khÃ´"` hoáº·c `mucusObservation = "Ã­t cháº¥t tiáº¿t"`
- **Chu ká»³ má»›i**: Chá»‰ tá»± Ä‘á»™ng táº¡o khi cÃ³ mÃ¡u má»›i xuáº¥t hiá»‡n (TrÆ°á»ng há»£p 1)

### VÃ­ dá»¥ Thá»±c táº¿

#### TrÆ°á»ng há»£p 1 - ThÃ nh cÃ´ng:
```bash
# Ghi nháº­n Ä‘á»§ dá»¯ liá»‡u tá»« ngÃ y 1-29 thÃ¡ng 1
# NgÃ y 14: NgÃ y Ä‘á»‰nh
# NgÃ y 17: NgÃ y 3 sau Ä‘á»‰nh = khÃ´
# NgÃ y 29: MÃ¡u má»›i xuáº¥t hiá»‡n

POST /api/menstrual-cycles/cycle_id/auto-complete
# Response: success = true, tá»± Ä‘á»™ng táº¡o chu ká»³ má»›i
```

#### TrÆ°á»ng há»£p 2 - Cáº§n theo dÃµi thÃªm:
```bash
# Ghi nháº­n dá»¯ liá»‡u tá»« 15/1 Ä‘áº¿n 5/2
# NgÃ y 26/1: NgÃ y Ä‘á»‰nh  
# NgÃ y 29/1: NgÃ y 3 sau Ä‘á»‰nh váº«n cÃ³ Ã­t cháº¥t tiáº¿t
# Láº¥n sang thÃ¡ng 2 vÃ  váº«n chÆ°a khÃ´ hoÃ n toÃ n

POST /api/menstrual-cycles/cycle_id/auto-complete
# Response: success = false, cáº§n theo dÃµi thÃªm
```

## 5. Há»‡ thá»‘ng Nháº¯c nhá»Ÿ (Reminder System)

### CÃ i Ä‘áº·t nháº¯c nhá»Ÿ
```http
PUT /api/reminders
Content-Type: application/json
Authorization: Bearer <token>

{
  "reminderEnabled": true,
  "reminderTime": "20:00"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Cáº­p nháº­t cÃ i Ä‘áº·t nháº¯c nhá»Ÿ thÃ nh cÃ´ng",
  "data": {
    "_id": "reminder_id",
    "userId": "user_id",
    "reminderEnabled": true,
    "reminderTime": "20:00",
    "lastNotifiedAt": null
  }
}
```

### Láº¥y cÃ i Ä‘áº·t nháº¯c nhá»Ÿ
```http
GET /api/reminders
Authorization: Bearer <token>
```

### Test gá»­i email nháº¯c nhá»Ÿ
```http
POST /api/reminders/test-email
Authorization: Bearer <token>
```

**Response:**
```json
{
  "success": true,
  "message": "Email nháº¯c nhá»Ÿ test Ä‘Ã£ Ä‘Æ°á»£c gá»­i thÃ nh cÃ´ng",
  "data": {
    "userId": "user_id",
    "email": "user@example.com",
    "sentAt": "2024-01-15T10:30:00.000Z"
  }
}
```

### Trigger nháº¯c nhá»Ÿ cho táº¥t cáº£ users (Admin/Cronjob)
```http
POST /api/reminders/notify
```

**LÆ°u Ã½:** Endpoint nÃ y khÃ´ng yÃªu cáº§u authentication Ä‘á»ƒ cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i bá»Ÿi cronjob.

**Response:**
```json
{
  "success": true,
  "message": "ÄÃ£ gá»­i nháº¯c nhá»Ÿ thÃ nh cÃ´ng",
  "data": {
    "notified": 15,
    "skipped": 8,
    "errors": 0
  }
}
```

### Thá»‘ng kÃª nháº¯c nhá»Ÿ (Admin)
```http
GET /api/reminders/stats
Authorization: Bearer <token>
```

**Response:**
```json
{
  "success": true,
  "data": {
    "totalUsers": 23,
    "enabledUsers": 18,
    "disabledUsers": 5,
    "popularReminderTimes": [
      { "_id": "20:00", "count": 8 },
      { "_id": "19:00", "count": 5 },
      { "_id": "21:00", "count": 3 }
    ]
  }
}
```

## Há»‡ thá»‘ng Email Nháº¯c nhá»Ÿ

### TÃ­nh nÄƒng
- **Tá»± Ä‘á»™ng gá»­i email** vÃ o thá»i gian Ä‘Ã£ Ä‘áº·t hÃ ng ngÃ y
- **Kiá»ƒm tra trÆ°á»›c khi gá»­i** xem user Ä‘Ã£ cáº­p nháº­t dá»¯ liá»‡u hÃ´m nay chÆ°a
- **Email template Ä‘áº¹p** vá»›i thÃ´ng tin há»¯u Ã­ch vá» viá»‡c theo dÃµi chu ká»³
- **Link trá»±c tiáº¿p** Ä‘áº¿n trang cáº­p nháº­t chu ká»³
- **CÃ i Ä‘áº·t linh hoáº¡t** cho tá»«ng user

### CÃ¡ch hoáº¡t Ä‘á»™ng
1. **Cronjob cháº¡y má»—i phÃºt** Ä‘á»ƒ kiá»ƒm tra thá»i gian nháº¯c nhá»Ÿ
2. **TÃ¬m users** cÃ³ `reminderEnabled: true` vÃ  `reminderTime` trÃ¹ng vá»›i thá»i gian hiá»‡n táº¡i
3. **Kiá»ƒm tra** xem user Ä‘Ã£ cáº­p nháº­t dá»¯ liá»‡u chu ká»³ hÃ´m nay chÆ°a
4. **Gá»­i email** náº¿u chÆ°a cáº­p nháº­t
5. **Cáº­p nháº­t** `lastNotifiedAt` Ä‘á»ƒ trÃ¡nh gá»­i trÃ¹ng láº·p

### Cáº¥u hÃ¬nh Email
Email sá»­ dá»¥ng **Gmail SMTP** vá»›i cÃ¡c biáº¿n mÃ´i trÆ°á»ng:
- `MAIL_USER`: Email Gmail
- `MAIL_PASSWORD`: App Password cá»§a Gmail
- `FRONTEND_URL`: URL frontend Ä‘á»ƒ táº¡o link trong email