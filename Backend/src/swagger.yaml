openapi: 3.0.0
info:
  title: Gender Healthcare API
  description: API cho dự án Gender Healthcare
  version: 1.0.0
  contact:
    email: admin@genderhealthcare.com

# THÊM GLOBAL SECURITY ĐỂ HIỆN NÚT AUTHORIZE TRONG SWAGGER UI
security:
  - bearerAuth: []

servers:
  - url: /api
    description: API prefix

tags:
  - name: Auth
    description: Xác thực và phân quyền
  - name: User
    description: Quản lý người dùng
  - name: OTP
    description: Quản lý mã OTP và xác thực
  - name: Doctor
    description: Quản lý bác sĩ

  - name: Service
    description: Quản lý dịch vụ (Chỉ Manager)
  - name: Service Package
    description: Quản lý gói dịch vụ (Chỉ Manager)

  - name: Doctor Schedules
    description: Quản lý lịch làm việc bác sĩ
  - name: Doctor QA
    description: Quản lý tư vấn bác sĩ - hệ thống tư vấn trực tuyến
  - name: Medical Records
    description: Quản lý hồ sơ khám bệnh - chỉ Doctor/Staff có thể tạo/sửa
  - name: Medicines
    description: Quản lý master data thuốc - chỉ Manager có quyền CRUD
  - name: Medication Reminders
    description: Quản lý nhắc nhở uống thuốc - User tạo từ medical records
  - name: Notification Days
    description: Quản lý lịch sử thông báo nhắc nhở uống thuốc
  - name: Test Categories
    description: Quản lý danh mục xét nghiệm
  - name: Appointment Tests
    description: Quản lý đặt lịch xét nghiệm
  - name: Test Results
    description: Quản lý kết quả xét nghiệm
  - name: Test Result Items
    description: Quản lý chi tiết kết quả xét nghiệm

  - name: Appointments
    description: Quản lý lịch hẹn và cuộc hẹn


paths:
  /auth/register:
    post:
      tags:
        - Auth
      summary: Đăng ký tài khoản mới
      description: Đăng ký tài khoản người dùng mới và gửi email xác thực
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - fullName
                - gender
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
                  minLength: 6
                fullName:
                  type: string
                  minLength: 3
                phone:
                  type: string
                gender:
                  type: string
                  enum: [male, female, other]
                  description: Giới tính người dùng
      responses:
        '201':
          description: Đăng ký thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Đăng ký thành công!
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                      fullName:
                        type: string
                      email:
                        type: string
                      role:
                        type: string
                      emailVerified:
                        type: boolean
                # Token sẽ được set vào cookie HTTP-only, không trả về trong body.
        '400':
          description: Lỗi dữ liệu đầu vào
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /auth/login:
    post:
      tags:
        - Auth
      summary: Đăng nhập
      description: Đăng nhập vào hệ thống
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
      responses:
        '200':
          description: Đăng nhập thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Đăng nhập thành công!
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                      fullName:
                        type: string
                      email:
                        type: string
                      role:
                        type: string
                      emailVerified:
                        type: boolean
                # Token sẽ được set vào cookie HTTP-only, không trả về trong body.
        '400':
          description: Lỗi dữ liệu đầu vào
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Không có quyền truy cập
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /auth/verify-email:
    post:
      tags:
        - Auth
        - OTP
      summary: Xác thực email
      description: Xác thực email sử dụng mã OTP gửi qua email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - otp
              properties:
                email:
                  type: string
                  format: email
                otp:
                  type: string
                  example: "123456"
      responses:
        '200':
          description: Xác thực thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Xác nhận tài khoản thành công
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                      fullName:
                        type: string
                      email:
                        type: string
                      emailVerified:
                        type: boolean
        '400':
          description: Mã không hợp lệ hoặc hết hạn
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /auth/request-otp:
    post:
      tags:
        - Auth
        - OTP
      summary: Yêu cầu mã OTP
      description: Yêu cầu mã OTP cho xác thực email, đặt lại mật khẩu, hoặc đăng nhập
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - type
              properties:
                email:
                  type: string
                  format: email
                type:
                  type: string
                  enum: [email_verification, password_reset, login]
      responses:
        '200':
          description: Gửi mã OTP thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Mã OTP đã được gửi đến email của bạn
        '404':
          description: Không tìm thấy người dùng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /auth/verify-otp:
    post:
      tags:
        - Auth
        - OTP
      summary: Xác thực mã OTP
      description: Xác thực mã OTP đã nhập
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - otp
                - type
              properties:
                userId:
                  type: string
                otp:
                  type: string
                  example: "123456"
                type:
                  type: string
                  enum: [email_verification, password_reset, login]
      responses:
        '200':
          description: Xác thực OTP thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '400':
          description: Mã OTP không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /auth/forgot-password:
    post:
      tags:
        - Auth
      summary: Quên mật khẩu
      description: Yêu cầu đặt lại mật khẩu thông qua email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Gửi email đặt lại mật khẩu thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Mã xác nhận đã được gửi đến email của bạn
        '404':
          description: Email không tồn tại
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /auth/reset-password:
    post:
      tags:
        - Auth
      summary: Đặt lại mật khẩu
      description: Đặt lại mật khẩu với mã OTP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - otp
                - newPassword
              properties:
                email:
                  type: string
                  format: email
                otp:
                  type: string
                newPassword:
                  type: string
                  format: password
                  minLength: 6
      responses:
        '200':
          description: Đặt lại mật khẩu thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Đặt lại mật khẩu thành công
        '400':
          description: Mã xác nhận không hợp lệ hoặc đã hết hạn
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /auth/check-email-verification:
    get:
      tags:
        - Auth
      summary: Kiểm tra trạng thái xác thực email
      description: Kiểm tra xem email của người dùng đã được xác thực chưa
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Trả về trạng thái xác thực email
          content:
            application/json:
              schema:
                type: object
                properties:
                  emailVerified:
                    type: boolean
                  email:
                    type: string
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /users/profile:
    get:
      tags:
        - User
      summary: Lấy thông tin người dùng
      description: Lấy thông tin profile của người dùng đã đăng nhập
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Thông tin người dùng
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy thông tin người dùng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /users/profile:
    put:
      tags:
        - User
      summary: Cập nhật thông tin người dùng
      description: Cập nhật thông tin profile của người dùng đã đăng nhập
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fullName:
                  type: string
                phone:
                  type: string
                avatar:
                  type: string
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Cập nhật thành công!
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /users/change-password:
    put:
      tags:
        - User
      summary: Đổi mật khẩu
      description: Đổi mật khẩu người dùng
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
                - newPassword
              properties:
                currentPassword:
                  type: string
                  format: password
                newPassword:
                  type: string
                  format: password
                  minLength: 6
      responses:
        '200':
          description: Đổi mật khẩu thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Đổi mật khẩu thành công
        '400':
          description: Mật khẩu hiện tại không đúng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users:
    post:
      tags:
        - User
      summary: Tạo user mới
      description: Tạo user mới (chỉ admin hoặc staff)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - fullName
              properties:
                email:
                  type: string
                password:
                  type: string
                fullName:
                  type: string
                phone:
                  type: string
                avatar:
                  type: string
                gender:
                  type: string
                address:
                  type: string
                year:
                  type: string
                  format: date
                role:
                  type: string
                  enum: [guest, customer, doctor, staff, manager, admin]
      responses:
        '201':
          description: Tạo user thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
        '400':
          description: Thiếu thông tin
        '409':
          description: Email đã tồn tại
        '500':
          description: Lỗi server

  /users/{userId}:
    get:
      tags:
        - User
      summary: Lấy thông tin user bất kỳ
      description: Lấy chi tiết user theo id (chỉ admin/staff)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Thông tin user
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
        '404':
          description: Không tìm thấy user
        '500':
          description: Lỗi server
    patch:
      tags:
        - User
      summary: Cập nhật user bất kỳ
      description: Cập nhật thông tin user theo id (chỉ admin/staff)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fullName:
                  type: string
                phone:
                  type: string
                avatar:
                  type: string
                gender:
                  type: string
                address:
                  type: string
                year:
                  type: string
                  format: date
                role:
                  type: string
                  enum: [guest, customer, doctor, staff, manager, admin]
                isActive:
                  type: boolean
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
        '404':
          description: Không tìm thấy user
        '500':
          description: Lỗi server

  /login-history:
    post:
      tags:
        - User
      summary: Ghi nhận lịch sử đăng nhập
      description: Ghi nhận một lần đăng nhập (thành công/thất bại)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - status
              properties:
                userId:
                  type: string
                ipAddress:
                  type: string
                userAgent:
                  type: string
                status:
                  type: string
                  enum: [success, failed]
                failReason:
                  type: string
      responses:
        '201':
          description: Ghi nhận thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/LoginHistory'
        '400':
          description: Thiếu thông tin
        '500':
          description: Lỗi server

  /login-history/{userId}:
    get:
      tags:
        - User
      summary: Lấy lịch sử đăng nhập của user
      description: Lấy danh sách lịch sử đăng nhập theo userId
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Danh sách lịch sử đăng nhập
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/LoginHistory'
        '400':
          description: Thiếu userId
        '500':
          description: Lỗi server

  /auth/google:
    post:
      tags:
        - Auth
      summary: Đăng nhập bằng Google
      description: Đăng nhập bằng Google OAuth2, nhận id_token từ FE, xác thực, trả về JWT và user info
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
              properties:
                token:
                  type: string
                  description: id_token từ Google
      responses:
        '200':
          description: Đăng nhập thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                # Token sẽ được set vào cookie HTTP-only, không trả về trong body.
        '400':
          description: Thiếu hoặc sai token
        '500':
          description: Lỗi server

  /auth/check-email:
    post:
      tags:
        - Auth
      summary: Kiểm tra email đã được sử dụng chưa
      description: Kiểm tra xem email đã tồn tại trong hệ thống hay chưa
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Trả về trạng thái có thể sử dụng email hay không
          content:
            application/json:
              schema:
                type: object
                properties:
                  available:
                    type: boolean
                    description: true nếu email chưa được sử dụng, false nếu đã tồn tại
        '400':
          description: Lỗi dữ liệu đầu vào
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/check-phone:
    post:
      tags:
        - Auth
      summary: Kiểm tra số điện thoại đã được sử dụng chưa
      description: Kiểm tra xem số điện thoại đã tồn tại trong hệ thống hay chưa
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - phone
              properties:
                phone:
                  type: string
                  description: Số điện thoại cần kiểm tra
      responses:
        '200':
          description: Trả về trạng thái có thể sử dụng số điện thoại hay không
          content:
            application/json:
              schema:
                type: object
                properties:
                  available:
                    type: boolean
                    description: true nếu số điện thoại chưa được sử dụng, false nếu đã tồn tại
        '400':
          description: Lỗi dữ liệu đầu vào
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/login-admin:
    post:
      tags:
        - Auth
      summary: Đăng nhập admin/staff
      description: Đăng nhập cho admin và staff với email và password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: admin@example.com
                password:
                  type: string
                  format: password
                  example: password123
      responses:
        '200':
          description: Đăng nhập thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Đăng nhập admin thành công!
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                      fullName:
                        type: string
                      email:
                        type: string
                      role:
                        type: string
                        enum: [admin, staff, manager]
                      emailVerified:
                        type: boolean
        '400':
          description: Lỗi dữ liệu đầu vào
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Sai email hoặc password, hoặc không phải admin/staff
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/login-google:
    post:
      tags:
        - Auth
      summary: Đăng nhập bằng Google
      description: Đăng nhập bằng Google OAuth token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
              properties:
                token:
                  type: string
                  description: Google OAuth token
                  example: ya29.a0AfH6SMC...
      responses:
        '200':
          description: Đăng nhập Google thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Đăng nhập Google thành công!
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                      fullName:
                        type: string
                      email:
                        type: string
                      role:
                        type: string
                      emailVerified:
                        type: boolean
        '400':
          description: Token Google không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/new-verify:
    post:
      tags:
        - Auth
        - OTP
      summary: Gửi lại email xác thực
      description: Gửi lại email chứa mã OTP để xác thực tài khoản
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
      responses:
        '200':
          description: Đã gửi lại email xác thực
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Đã gửi lại email xác thực!
        '400':
          description: Email không hợp lệ hoặc đã được xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy tài khoản với email này
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/profile/me:
    get:
      tags:
        - User
      summary: Lấy thông tin profile của user hiện tại
      description: Lấy thông tin profile của user đã đăng nhập
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Lấy thông tin profile thành công
                  data:
                    $ref: '#/components/schemas/UserProfile'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      tags:
        - User
      summary: Cập nhật thông tin profile
      description: Cập nhật thông tin profile của user đã đăng nhập
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fullName:
                  type: string
                  example: Nguyễn Văn A
                phone:
                  type: string
                  example: "0123456789"
                gender:
                  type: string
                  enum: [male, female, other]
                  example: male
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Cập nhật profile thành công
                  data:
                    $ref: '#/components/schemas/UserProfile'
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/profile/me/change-password:
    put:
      tags:
        - User
      summary: Đổi mật khẩu
      description: Đổi mật khẩu cho user đã đăng nhập
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - oldPassword
                - newPassword
              properties:
                oldPassword:
                  type: string
                  format: password
                  example: oldPassword123
                newPassword:
                  type: string
                  format: password
                  minLength: 6
                  example: newPassword123
      responses:
        '200':
          description: Đổi mật khẩu thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Đổi mật khẩu thành công
        '400':
          description: Mật khẩu cũ sai hoặc mật khẩu mới không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/profile/me/avatar:
    put:
      tags:
        - User
      summary: Cập nhật URL avatar
      description: Cập nhật URL avatar cho user đã đăng nhập
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - avatar
              properties:
                avatar:
                  type: string
                  example: https://res.cloudinary.com/your-cloud/image/upload/v123/avatar.jpg
      responses:
        '200':
          description: Cập nhật avatar thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Cập nhật avatar thành công
                  data:
                    $ref: '#/components/schemas/User'
        '400':
          description: Thiếu URL avatar
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/profile/me/avatar/upload:
    post:
      tags:
        - User
      summary: Upload avatar cho user
      description: Upload file ảnh avatar lên server, trả về URL ảnh đã upload
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                avatar:
                  type: string
                  format: binary
      responses:
        '200':
          description: Upload thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    example: https://res.cloudinary.com/your-cloud/image/upload/v123/avatar.jpg
        '400':
          description: Lỗi upload hoặc thiếu file
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors:
    get:
      tags:
        - Doctor
      summary: Lấy danh sách tất cả bác sĩ (cho phép guest)
      description: Lấy danh sách tất cả bác sĩ, không yêu cầu xác thực. Bất kỳ ai cũng có thể truy cập.
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Doctor'

    post:
      tags:
        - Doctor
      summary: Tạo bác sĩ mới (tự động tạo user account)
      description: Tạo bác sĩ mới. Hệ thống sẽ tự động tạo user account với email được sinh từ tên bác sĩ và password mặc định.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - fullName
              properties:
                fullName:
                  type: string
                  example: "BS. Nguyễn Văn A"
                  description: "Tên đầy đủ của bác sĩ (bắt buộc, dùng để tạo email)"
                phone:
                  type: string
                  example: "0123456789"
                gender:
                  type: string
                  enum: [male, female, other]
                  example: "male"
                address:
                  type: string
                  example: "TP. Hồ Chí Minh"
                bio:
                  type: string
                  example: "Chuyên gia về sức khỏe sinh sản"
                experience:
                  type: number
                  example: 5
                rating:
                  type: number
                  minimum: 0
                  maximum: 5
                  example: 4.5
                specialization:
                  type: string
                  example: "Phụ khoa - Sinh sản"
                education:
                  type: string
                  example: "Thạc sĩ Y khoa - Đại học Y Dược"
                certificate:
                  type: string
                  example: "Chứng chỉ chuyên khoa cấp I"
      responses:
        '201':
          description: Đã tạo bác sĩ thành công (kèm thông tin user được tạo tự động)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Doctor'
        '400':
          description: Thiếu tên bác sĩ hoặc dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Email được tạo tự động đã tồn tại (tên bác sĩ trùng)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập (chỉ staff/admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/{id}:
    get:
      tags:
        - Doctor
      summary: Lấy thông tin bác sĩ theo ID (cho phép guest)
      description: Lấy thông tin chi tiết bác sĩ theo ID, không yêu cầu xác thực. Bất kỳ ai cũng có thể truy cập.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Doctor'
        '404':
          description: Không tìm thấy bác sĩ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Doctor
      summary: Cập nhật thông tin bác sĩ (không thể sửa userId)
      description: Cập nhật thông tin bác sĩ. Lưu ý userId không thể được thay đổi để đảm bảo tính toàn vẹn dữ liệu.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DoctorUpdateRequest'
      responses:
        '200':
          description: Đã cập nhật bác sĩ thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Doctor'
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập (chỉ staff/admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy bác sĩ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Doctor
      summary: Xóa bác sĩ (MANAGER/ADMIN ONLY)
      description: Chỉ Manager hoặc Admin mới có quyền xóa bác sĩ
      summary: Xóa bác sĩ
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':

          description: Đã xóa bác sĩ
        '401':
          description: Chưa xác thực
        '403':
          description: Không có quyền (chỉ Manager/Admin)

  /services:
    get:
      tags:
        - Service
      summary: Lấy danh sách dịch vụ
      description: Lấy danh sách tất cả dịch vụ với phân trang và bộ lọc (Public access)
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Số trang
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Số lượng item mỗi trang
        - in: query
          name: sortBy
          schema:
            type: string
            default: createdAt
          description: Trường để sắp xếp
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Thứ tự sắp xếp
        - in: query
          name: serviceType
          schema:
            type: string
            enum: [consultation, test, treatment, other]
          description: Lọc theo loại dịch vụ
        - in: query
          name: availableAt
          schema:
            type: string
            enum: [Athome, Online, Center]
          description: Lọc theo địa điểm cung cấp
        - in: query
          name: search
          schema:
            type: string
          description: Tìm kiếm theo tên dịch vụ
      responses:
        '200':
          description: Danh sách dịch vụ

          description: Đã xóa bác sĩ thành công

          content:
            application/json:
              schema:
                type: object
                properties:

                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      services:
                        type: array
                        items:
                          $ref: '#/components/schemas/Service'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập (không phải Manager)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Service
      summary: Tạo dịch vụ mới
      description: Tạo một dịch vụ mới (Chỉ Manager)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - serviceName
                - price
                - description
                - serviceType
                - availableAt
              properties:
                serviceName:
                  type: string
                  description: Tên dịch vụ
                  example: "Tư vấn sức khỏe sinh sản"
                price:
                  type: number
                  minimum: 0
                  description: Giá dịch vụ
                  example: 500000
                description:
                  type: string
                  description: Mô tả dịch vụ
                  example: "Tư vấn chuyên sâu về sức khỏe sinh sản cho phụ nữ"
                image:
                  type: string
                  description: URL hình ảnh dịch vụ
                  example: "https://example.com/service-image.jpg"
                serviceType:
                  type: string
                  enum: [consultation, test, treatment, other]
                  description: Loại dịch vụ
                  example: "consultation"
                availableAt:
                  type: array
                  items:
                    type: string
                    enum: [Athome, Online, Center]
                  description: Các địa điểm cung cấp dịch vụ
                  example: ["Online", "Center"]
      responses:
        '201':
          description: Tạo dịch vụ thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Service'
                  message:
                    type: string
                    example: "Service created successfully"
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập (không phải Manager)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Tên dịch vụ đã tồn tại
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /services/{id}:
    put:
      tags:
        - Service
      summary: Cập nhật dịch vụ
      description: Cập nhật thông tin dịch vụ theo ID (Chỉ Manager)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của dịch vụ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                serviceName:
                  type: string
                  description: Tên dịch vụ
                  example: "Tư vấn sức khỏe sinh sản"
                price:
                  type: number
                  minimum: 0
                  description: Giá dịch vụ
                  example: 500000
                description:
                  type: string
                  description: Mô tả dịch vụ
                  example: "Tư vấn chuyên sâu về sức khỏe sinh sản cho phụ nữ"
                image:
                  type: string
                  description: URL hình ảnh dịch vụ
                  example: "https://example.com/service-image.jpg"
                serviceType:
                  type: string
                  enum: [consultation, test, treatment, other]
                  description: Loại dịch vụ
                  example: "consultation"
                availableAt:
                  type: array
                  items:
                    type: string
                    enum: [Athome, Online, Center]
                  description: Các địa điểm cung cấp dịch vụ
                  example: ["Online", "Center"]
      responses:
        '200':
          description: Cập nhật dịch vụ thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Service'
                  message:
                    type: string
                    example: "Service updated successfully"
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập (không phải Manager)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy dịch vụ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Tên dịch vụ đã tồn tại
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Service
      summary: Xóa dịch vụ
      description: Xóa mềm dịch vụ theo ID (Chỉ Manager)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của dịch vụ
      responses:
        '200':
          description: Xóa dịch vụ thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Service deleted successfully"
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập (không phải Manager)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy dịch vụ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /service-packages:
    get:
      tags:
        - Service Package
      summary: Lấy danh sách gói dịch vụ
      description: Lấy danh sách tất cả gói dịch vụ với phân trang và bộ lọc (Public access)
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Số trang
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Số lượng item mỗi trang
        - in: query
          name: sortBy
          schema:
            type: string
            default: createdAt
          description: Trường để sắp xếp
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Thứ tự sắp xếp
        - in: query
          name: isActive
          schema:
            type: integer
            enum: [0, 1]
          description: Lọc theo trạng thái hoạt động
        - in: query
          name: search
          schema:
            type: string
          description: Tìm kiếm theo tên gói dịch vụ
      responses:
        '200':
          description: Danh sách gói dịch vụ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      packages:
                        type: array
                        items:
                          $ref: '#/components/schemas/ServicePackage'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Service Package
      summary: Tạo gói dịch vụ mới
      description: Tạo một gói dịch vụ mới (Chỉ Manager)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - description
                - priceBeforeDiscount
                - price
                - serviceIds
              properties:
                name:
                  type: string
                  description: Tên gói dịch vụ
                  example: "Gói chăm sóc sức khỏe sinh sản toàn diện"
                description:
                  type: string
                  description: Mô tả gói dịch vụ
                  example: "Gói dịch vụ bao gồm tư vấn, khám và xét nghiệm"
                priceBeforeDiscount:
                  type: number
                  minimum: 0
                  description: Giá gốc trước giảm giá
                  example: 2000000
                price:
                  type: number
                  minimum: 0
                  description: Giá sau giảm giá
                  example: 1500000
                serviceIds:
                  type: array
                  items:
                    type: string
                  description: Danh sách ID của các dịch vụ trong gói
                  example: ["64a1b2c3d4e5f6g7h8i9j0k1", "64a1b2c3d4e5f6g7h8i9j0k2"]
                image:
                  type: string
                  description: URL hình ảnh gói dịch vụ
                  example: "https://example.com/package-image.jpg"
      responses:
        '201':
          description: Tạo gói dịch vụ thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/ServicePackage'
                  message:
                    type: string
                    example: "Service package created successfully"
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':

          description: Không có quyền truy cập (không phải Manager)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Tên gói dịch vụ đã tồn tại
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /service-packages/{id}:
    put:
      tags:
        - Service Package
      summary: Cập nhật gói dịch vụ
      description: Cập nhật thông tin gói dịch vụ theo ID (Chỉ Manager)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của gói dịch vụ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: Tên gói dịch vụ
                  example: "Gói chăm sóc sức khỏe sinh sản toàn diện"
                description:
                  type: string
                  description: Mô tả gói dịch vụ
                  example: "Gói dịch vụ bao gồm tư vấn, khám và xét nghiệm"
                priceBeforeDiscount:
                  type: number
                  minimum: 0
                  description: Giá gốc trước giảm giá
                  example: 2000000
                price:
                  type: number
                  minimum: 0
                  description: Giá sau giảm giá
                  example: 1500000
                serviceIds:
                  type: array
                  items:
                    type: string
                  description: Danh sách ID của các dịch vụ trong gói
                  example: ["64a1b2c3d4e5f6g7h8i9j0k1", "64a1b2c3d4e5f6g7h8i9j0k2"]
                isActive:
                  type: integer
                  enum: [0, 1]
                  description: Trạng thái hoạt động (1 = active, 0 = inactive)
                  example: 1
                image:
                  type: string
                  description: URL hình ảnh gói dịch vụ
                  example: "https://example.com/package-image.jpg"
      responses:
        '200':
          description: Cập nhật gói dịch vụ thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/ServicePackage'
                  message:
                    type: string
                    example: "Service package updated successfully"
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập (không phải Manager)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy gói dịch vụ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Tên gói dịch vụ đã tồn tại
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Service Package
      summary: Xóa gói dịch vụ
      description: Xóa gói dịch vụ theo ID (Chỉ Manager)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của gói dịch vụ
      responses:
        '200':
          description: Xóa gói dịch vụ thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Service package deleted successfully"
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập (không phải Manager)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy gói dịch vụ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ===== TEST CATEGORIES APIs =====
  /test-categories:
  /appointments:
    get:
      tags:
        - Appointments
      summary: Lấy danh sách cuộc hẹn
      description: Lấy danh sách cuộc hẹn với phân trang và lọc
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Số trang
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: Số lượng kết quả mỗi trang
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, confirmed, completed, cancelled]
          description: Lọc theo trạng thái cuộc hẹn
        - name: appointmentType
          in: query
          schema:
            type: string
            enum: [consultation, test, other]
          description: Lọc theo loại cuộc hẹn
        - name: startDate
          in: query
          schema:
            type: string
            format: date
          description: Lọc từ ngày (YYYY-MM-DD)
        - name: endDate
          in: query
          schema:
            type: string
            format: date
          description: Lọc đến ngày (YYYY-MM-DD)
        - name: profileId
          in: query
          schema:
            type: string
          description: Lọc theo ID hồ sơ người dùng
        - name: createdByUserId
          in: query
          schema:
            type: string
          description: Lọc theo ID người tạo cuộc hẹn
      responses:
        '200':
          description: Danh sách cuộc hẹn
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      appointments:
                        type: array
                        items:
                          $ref: '#/components/schemas/Appointment'
                      pagination:
                        type: object
                        properties:
                          total:
                            type: integer
                            example: 45
                          page:
                            type: integer
                            example: 1
                            limit:
                            type: integer
                            example: 10
                          pages:
                            type: integer
                            example: 5
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    
    post:
      tags:
        - Appointments
      summary: Tạo cuộc hẹn mới
      description: Đặt lịch hẹn mới với dịch vụ, gói dịch vụ hoặc bác sĩ
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - profileId
                - appointmentDate
                - appointmentTime
                - appointmentType
                - typeLocation
              properties:
                profileId:
                  type: string
                  description: ID hồ sơ người dùng
                  example: "60d5ecb8b392e1b8c8f5c123"
                packageId:
                  type: string
                  description: ID gói dịch vụ (nếu có)
                  example: "60d5ecb8b392e1b8c8f5c456"
                serviceId:
                  type: string
                  description: ID dịch vụ (nếu có)
                  example: "60d5ecb8b392e1b8c8f5c789"
                slotId:
                  type: string
                  description: ID slot thời gian (nếu có)
                  example: "60d5ecb8b392e1b8c8f5c101"
                appointmentDate:
                  type: string
                  format: date
                  description: Ngày hẹn (YYYY-MM-DD)
                  example: "2023-06-15"
                appointmentTime:
                  type: string
                  description: Giờ hẹn (HH:MM)
                  example: "14:30"
                appointmentType:
                  type: string
                  enum: [consultation, test, other]
                  description: Loại cuộc hẹn
                  example: "consultation"
                typeLocation:
                  type: string
                  enum: [clinic, home, Online]
                  description: Loại địa điểm
                  example: "clinic"
                address:
                  type: string
                  description: Địa chỉ (bắt buộc nếu typeLocation là home)
                  example: "123 Đường ABC, Quận 1, TP.HCM"
                description:
                  type: string
                  description: Mô tả cuộc hẹn
                  example: "Khám sức khỏe định kỳ"
                notes:
                  type: string
                  description: Ghi chú thêm
                  example: "Tôi có tiền sử bệnh tim"
      responses:
        '201':
          description: Tạo cuộc hẹn thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Đặt lịch hẹn thành công"
                  data:
                    $ref: '#/components/schemas/Appointment'
        '400':
          description: Dữ liệu đầu vào không hợp lệ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  errors:
                    type: object
                    properties:
                      general:
                        type: string
                        example: "Phải cung cấp một trong hai: packageId hoặc serviceId"
        '401':
          description: Không có quyền truy cập
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy tài nguyên
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Không tìm thấy hồ sơ người dùng"
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /appointments/{id}:
    get:
      tags:
        - Appointments
      summary: Lấy chi tiết cuộc hẹn
      description: Lấy thông tin chi tiết của một cuộc hẹn theo ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID của cuộc hẹn
      responses:
        '200':
          description: Chi tiết cuộc hẹn
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Appointment'
        '400':
          description: ID không hợp lệ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  errors:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "ID cuộc hẹn không hợp lệ"
        '404':
          description: Không tìm thấy cuộc hẹn
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Không tìm thấy cuộc hẹn"
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    
    put:
      tags:
        - Appointments
      summary: Cập nhật cuộc hẹn
      description: Cập nhật thông tin cuộc hẹn
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID của cuộc hẹn
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                profileId:
                  type: string
                  description: ID hồ sơ người dùng
                packageId:
                  type: string
                  description: ID gói dịch vụ
                serviceId:
                  type: string
                  description: ID dịch vụ
                slotId:
                  type: string
                  description: ID slot thời gian
                appointmentDate:
                  type: string
                  format: date
                  description: Ngày hẹn (YYYY-MM-DD)
                appointmentTime:
                  type: string
                  description: Giờ hẹn (HH:MM)
                appointmentType:
                  type: string
                  enum: [consultation, test, other]
                  description: Loại cuộc hẹn
                typeLocation:
                  type: string
                  enum: [clinic, home, Online]
                  description: Loại địa điểm
                address:
                  type: string
                  description: Địa chỉ (bắt buộc nếu typeLocation là home)
                description:
                  type: string
                  description: Mô tả cuộc hẹn
                notes:
                  type: string
                  description: Ghi chú thêm
      responses:
        '200':
          description: Cập nhật cuộc hẹn thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Cập nhật cuộc hẹn thành công"
                  data:
                    $ref: '#/components/schemas/Appointment'
        '400':
          description: Dữ liệu đầu vào không hợp lệ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  errors:
                    type: object
                    properties:
                      status:
                        type: string
                        example: "Không thể cập nhật cuộc hẹn đã hoàn thành hoặc đã hủy"
        '401':
          description: Không có quyền truy cập
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy cuộc hẹn
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Không tìm thấy cuộc hẹn"
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    
    delete:
      tags:
        - Appointments
      summary: Hủy cuộc hẹn
      description: Hủy cuộc hẹn (xóa mềm - cập nhật trạng thái thành cancelled)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID của cuộc hẹn
      responses:
        '200':
          description: Hủy cuộc hẹn thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Hủy cuộc hẹn thành công"
                  data:
                    $ref: '#/components/schemas/Appointment'
        '400':
          description: Không thể hủy cuộc hẹn
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  errors:
                    type: object
                    properties:
                      status:
                        type: string
                        example: "Không thể hủy cuộc hẹn đã hoàn thành hoặc đã hủy"
        '401':
          description: Không có quyền truy cập
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy cuộc hẹn
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Không tìm thấy cuộc hẹn"
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /appointments/{id}/status:
    put:
      tags:
        - Appointments
      summary: Cập nhật trạng thái cuộc hẹn
      description: Cập nhật trạng thái cuộc hẹn
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID của cuộc hẹn
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [pending, confirmed, completed, cancelled]
                  description: Trạng thái mới của cuộc hẹn
                  example: "confirmed"
      responses:
        '200':
          description: Cập nhật trạng thái cuộc hẹn thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Cập nhật trạng thái cuộc hẹn thành công"
                  data:
                    $ref: '#/components/schemas/Appointment'
        '400':
          description: Dữ liệu đầu vào không hợp lệ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  errors:
                    type: object
                    properties:
                      status:
                        type: string
                        example: "Trạng thái không hợp lệ"
        '401':
          description: Không có quyền truy cập
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy cuộc hẹn
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Không tìm thấy cuộc hẹn"
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /user-profiles:
    post:
      tags:
        - UserProfile
      summary: Tạo profile mới
      description: Tạo profile cho user đã đăng nhập. Mỗi user có thể có nhiều profiles.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserProfileRequest'
      responses:
        '201':
          description: Tạo profile thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/UserProfile'
        '400':
          description: Thiếu thông tin bắt buộc
        '401':
          description: Chưa xác thực

    get:
      tags:
        - UserProfile
      summary: Lấy tất cả profiles (Admin/Staff only)
      description: Lấy danh sách tất cả user profiles với phân trang
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/UserProfile'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          description: Chưa xác thực
        '403':
          description: Không có quyền truy cập

  /user-profiles/me:
    get:
      tags:
        - UserProfile
      summary: Lấy tất cả profiles của chính mình
      description: Lấy tất cả profiles của user đang đăng nhập
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/UserProfile'
                  count:
                    type: integer
                    description: Số lượng profiles
        '401':
          description: Chưa xác thực

  /user-profiles/{id}:
    get:
      tags:
        - UserProfile
      summary: Lấy profile theo ID
      description: Lấy profile theo ID. Chỉ owner hoặc admin/staff mới xem được.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/UserProfile'
        '400':
          description: ID không hợp lệ
        '404':
          description: Không tìm thấy profile
        '403':
          description: Không có quyền truy cập
        '401':
          description: Chưa xác thực

    put:
      tags:
        - UserProfile
      summary: Cập nhật profile
      description: Cập nhật profile theo ID. Chỉ owner hoặc admin/staff mới cập nhật được.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserProfileUpdateRequest'
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/UserProfile'
        '400':
          description: ID không hợp lệ
        '404':
          description: Không tìm thấy profile
        '403':
          description: Không có quyền chỉnh sửa
        '401':
          description: Chưa xác thực

    delete:
      tags:
        - UserProfile
      summary: Xóa profile
      description: Xóa profile theo ID. Chỉ owner hoặc admin mới xóa được.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Xóa thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                      deleted:
                        type: boolean
        '400':
          description: ID không hợp lệ
        '404':
          description: Không tìm thấy profile
        '403':
          description: Không có quyền xóa
        '401':
          description: Chưa xác thực

  /doctors/schedules/all:
    get:
      tags:
        - Doctor Schedules
      summary: Lấy tất cả lịch làm việc của tất cả bác sĩ (PUBLIC - chỉ Free status)
      description: Lấy tất cả lịch làm việc của tất cả bác sĩ - chỉ hiển thị slot có status Free để customer có thể xem toàn bộ
      responses:
        '200':
          description: Lấy tất cả lịch làm việc thành công (chỉ hiển thị slot trống)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy tất cả lịch làm việc thành công (chỉ hiển thị slot trống) - Tìm thấy 5 bác sĩ có lịch làm việc"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DoctorSchedule'
                  totalDoctorsWithSchedules:
                    type: integer
                    example: 5
                    description: Tổng số bác sĩ có lịch làm việc
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/{id}/schedules:
    get:
      tags:
        - Doctor Schedules
      summary: Xem lịch làm việc của bác sĩ (PUBLIC - chỉ Free status)
      description: Lấy lịch làm việc của bác sĩ - chỉ hiển thị slot có status Free để customer có thể xem
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của bác sĩ
      responses:
        '200':
          description: Lấy lịch làm việc thành công (chỉ hiển thị slot trống)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy lịch làm việc thành công (chỉ hiển thị slot trống)"
                  data:
                    $ref: '#/components/schemas/DoctorSchedule'
        '404':
          description: Bác sĩ chưa có lịch làm việc nào
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/{id}/available-slots:
    get:
      tags:
        - Doctor Schedules
      summary: Xem slot trống của bác sĩ theo ngày (PUBLIC - chỉ Free status)
      description: Lấy danh sách slot có status Free của bác sĩ trong ngày cụ thể - không cần đăng nhập
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của bác sĩ
        - in: query
          name: date
          required: true
          schema:
            type: string
            format: date
          example: "2024-01-15"
          description: Ngày cần xem slot trống (YYYY-MM-DD)
      responses:
        '200':
          description: Lấy slot trống thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Tìm thấy 5 slot trống trong ngày 2024-01-15"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AvailableSlot'
        '400':
          description: Thiếu tham số date
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/available:
    get:
      tags:
        - Doctor Schedules
      summary: Tìm tất cả bác sĩ có lịch trống theo ngày (PUBLIC - chỉ Free status)
      description: Lấy danh sách tất cả bác sĩ có slot Free trong ngày cụ thể, có thể lọc theo khung giờ - không cần đăng nhập
      parameters:
        - in: query
          name: date
          required: true
          schema:
            type: string
            format: date
          example: "2024-01-15"
          description: Ngày cần tìm bác sĩ có lịch trống (YYYY-MM-DD)
        - in: query
          name: timeSlot
          required: false
          schema:
            type: string
          example: "07:00-08:00"
          description: Khung giờ cụ thể (tuỳ chọn). Nếu không có sẽ tìm tất cả bác sĩ có ít nhất 1 slot Free
      responses:
        '200':
          description: Tìm bác sĩ có lịch trống thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Tìm thấy 3 bác sĩ có lịch trống trong ngày 2024-01-15"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AvailableDoctor'
                  searchCriteria:
                    type: object
                    properties:
                      date:
                        type: string
                        example: "2024-01-15"
                      timeSlot:
                        type: string
                        example: "07:00-08:00"
                      totalFound:
                        type: integer
                        example: 3
        '400':
          description: Thiếu tham số date
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/schedules/all/staff:
    get:
      tags:
        - Doctor Schedules
      summary: Staff xem tất cả lịch làm việc của tất cả bác sĩ (STAFF/MANAGER/ADMIN)
      description: Staff/Manager/Admin xem tất cả lịch làm việc của tất cả bác sĩ với mọi status (Free, Booked, Absent)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lấy tất cả lịch làm việc thành công (tất cả status)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy tất cả lịch làm việc thành công (tất cả status) - Tìm thấy 5 bác sĩ có lịch làm việc"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DoctorSchedule'
                  totalDoctorsWithSchedules:
                    type: integer
                    example: 5
                    description: Tổng số bác sĩ có lịch làm việc
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff/manager/admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/statistics/all:
    get:
      tags:
        - Doctor Schedules
      summary: Lấy thống kê tổng của tất cả bác sĩ (STAFF/MANAGER/ADMIN)
      description: Lấy thống kê tổng quan về slot booking của tất cả bác sĩ
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lấy thống kê thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy thống kê tất cả bác sĩ thành công"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DoctorStatistics'
                  totalDoctors:
                    type: integer
                    example: 10
                    description: Tổng số bác sĩ
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff/manager/admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/{id}/statistics:
    get:
      tags:
        - Doctor Schedules
      summary: Lấy thống kê của bác sĩ cụ thể (STAFF/MANAGER/ADMIN)
      description: Lấy thống kê chi tiết về slot booking của một bác sĩ
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của bác sĩ
      responses:
        '200':
          description: Lấy thống kê thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy thống kê bác sĩ thành công"
                  data:
                    $ref: '#/components/schemas/DoctorStatistics'
        '404':
          description: Bác sĩ không tồn tại
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff/manager/admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ===== DOCTOR SCHEDULE APIs =====
  

  # ===== PUBLIC ROUTES (không cần xác thực) =====
  
  /doctors/schedules/all:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  
  schemas:
    User:
      type: object
      properties:
        id:
        email:
          type: string
        fullName:
          type: string
        phone:
          type: string
        avatar:
          type: string
        role:
          type: string
          enum:
            - guest
            - customer
            - doctor
            - staff
            - manager
            - admin
        emailVerified:
          type: boolean
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    
    UserProfile:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        fullName:
          type: string
        phone:
          type: string
        avatar:
          type: string
        role:
          type: string
        emailVerified:
          type: boolean
        isActive:
          type: boolean
    
    OtpCode:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        type:
          type: string
          enum:
            - email_verification
            - password_reset
            - login
        otp:
          type: string
        expires:
          type: string
          format: date-time
        verified:
          type: boolean
        verifiedAt:
          type: string
          format: date-time
        attempts:
          type: integer
        createdAt:
          type: string
          format: date-time
    
    Error:
      type: object
      properties:
        message:
          type: string

    LoginHistory:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        ipAddress:
          type: string
        userAgent:
          type: string
        loginAt:
          type: string
          format: date-time
        status:
          type: string
          enum: [success, failed]
        failReason:
          type: string

    Doctor:
      type: object
      properties:
        userId:
          type: string
        bio:
          type: string
        experience:
          type: number
        rating:
          type: number
        specialization:
          type: string
        education:
          type: string
        certificate:
          type: string


    # ===== DOCTOR SCHEDULE SCHEMAS =====
    TimeSlot:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        slotTime:
          type: string
          example: "07:00-08:00"
          description: Khung giờ làm việc
        status:
          type: string
          enum: [Free, Booked, Absent]
          example: "Free"
          description: Trạng thái slot - Free (trống), Booked (đã đặt), Absent (bác sĩ nghỉ)

    WeekSchedule:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439012"
        dayOfWeek:
          type: string
          format: date-time
          example: "2024-01-15T00:00:00.000Z"
          description: Ngày làm việc
        slots:
          type: array
          items:
            $ref: '#/components/schemas/TimeSlot'
          description: Danh sách 8 slot thời gian trong ngày

    DoctorSchedule:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439013"
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        weekSchedule:
          type: array
          items:
            $ref: '#/components/schemas/WeekSchedule'
          description: Lịch làm việc theo từng ngày
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    AvailableSlot:
      type: object
      properties:
        slotId:
          type: string
          example: "507f1f77bcf86cd799439011"
          description: ID của slot trống
        slotTime:
          type: string
          example: "07:00-08:00"
          description: Khung giờ trống
        status:
          type: string
          example: "Free"
          description: Luôn là Free vì chỉ trả về slot trống cho public

    AvailableDoctor:
      type: object
      properties:
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        doctorInfo:
          type: object
          properties:
            fullName:
              type: string
              example: "Dr. Nguyễn Văn A"
            email:
              type: string
              example: "dr.nguyen@genderhealthcare.com"
            avatar:
              type: string
              example: "https://example.com/avatar.jpg"
            specialization:
              type: string
              example: "Nội khoa"
            experience:
              type: number
              example: 5
            rating:
              type: number
              example: 4.5
        availableSlots:
          type: array
          items:
            $ref: '#/components/schemas/AvailableSlot'
          description: Danh sách slot Free của bác sĩ (chỉ public)
        totalAvailableSlots:
          type: integer
          example: 3

    StaffSlot:
      type: object
      properties:
        slotId:
          type: string
          example: "507f1f77bcf86cd799439011"
          description: ID của slot
        slotTime:
          type: string
          example: "07:00-08:00"
          description: Khung giờ
        status:
          type: string
          enum: [Free, Booked, Absent]
          example: "Booked"
          description: Trạng thái slot cho staff xem

    StaffAvailableDoctor:
      type: object
      properties:
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        doctorInfo:
          type: object
          properties:
            fullName:
              type: string
              example: "Dr. Nguyễn Văn A"
            email:
              type: string
              example: "dr.nguyen@genderhealthcare.com"
            avatar:
              type: string
              example: "https://example.com/avatar.jpg"
            specialization:
              type: string
              example: "Nội khoa"
            experience:
              type: number
              example: 5
            rating:
              type: number
              example: 4.5
        availableSlots:
          type: array
          items:
            $ref: '#/components/schemas/StaffSlot'
          description: Danh sách tất cả slots của bác sĩ (cho staff)
        totalAvailableSlots:
          type: integer
          example: 8
          description: Tổng số slots

    DoctorStatistics:
      type: object
      properties:
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        name:
          type: string
          example: "Dr. Nguyễn Văn A"
          description: Tên bác sĩ
        bookedSlots:
          type: integer
          example: 15
          description: Tổng số slot đã được đặt (status Booked)
        absentSlots:
          type: integer
          example: 5
          description: Tổng số slot vắng mặt lẻ (status Absent) - không tính slot đã thành ngày nghỉ
        absentDays:
          type: integer
          example: 2
          description: Số ngày nghỉ (mỗi ngày có đủ 8 slot Absent = 1 ngày nghỉ)

    LeastBookedDoctor:
      type: object
      properties:
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        name:
          type: string
          example: "Dr. Nguyễn Văn A"
          description: Tên bác sĩ
        bookedSlots:
          type: integer
          example: 3
          description: Số slot đã được đặt
        absentSlots:
          type: integer
          example: 1
          description: Số slot vắng mặt lẻ
        absentDays:
          type: integer
          example: 0
          description: Số ngày nghỉ

    DoctorQA:
      type: object
      properties:
        _id:
          type: string
          example: "675e4bcd6dc1234567890123"
          description: ID của yêu cầu tư vấn
        doctorId:
          type: object
          properties:
            _id:
              type: string
              example: "675e4bcd6dc1234567890abc"
            userId:
              type: object
              properties:
                _id:
                  type: string
                  example: "675e4bcd6dc1234567890def"
                fullName:
                  type: string
                  example: "Dr. Nguyễn Văn A"
                email:
                  type: string
                  example: "dr.nguyen@genderhealthcare.com"
            bio:
              type: string
              example: "Bác sĩ chuyên khoa Nội"
            specialization:
              type: string
              example: "Nội khoa"
        userId:
          type: object
          properties:
            _id:
              type: string
              example: "675e4bcd6dc1234567890ghi"
            fullName:
              type: string
              example: "Nguyễn Văn B"
            email:
              type: string
              example: "user@example.com"
        fullName:
          type: string
          example: "Nguyễn Văn B"
          description: Họ tên người yêu cầu tư vấn
        phone:
          type: string
          example: "0987654321"
          description: Số điện thoại liên hệ
        question:
          type: string
          example: "Tôi bị đau bụng thường xuyên, có phải bệnh gì không?"
          description: Câu hỏi/vấn đề cần tư vấn
        notes:
          type: string
          example: "Triệu chứng kéo dài 2 tuần"
          description: Ghi chú thêm
        status:
          type: string
          enum: [pending_payment, paid, doctor_confirmed, scheduled, consulting, completed, cancelled]
          example: "pending_payment"
          description: Trạng thái yêu cầu tư vấn
        consultationFee:
          type: number
          example: 200000
          description: Phí tư vấn (VND)
        appointmentDate:
          type: string
          format: date-time
          example: "2024-01-20T00:00:00.000Z"
          description: Ngày hẹn tư vấn
        appointmentSlot:
          type: string
          example: "14:00-15:00"
          description: Khung giờ tư vấn
        slotId:
          type: string
          example: "675e4bcd6dc1234567890jkl"
          description: ID của slot đã book
        doctorNotes:
          type: string
          example: "Đã tư vấn xong, khuyên nên khám thêm"
          description: Ghi chú của bác sĩ
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00.000Z"
          description: Thời gian tạo yêu cầu
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-15T14:45:00.000Z"
          description: Thời gian cập nhật cuối

    DoctorWithUser:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        doctor:
          $ref: '#/components/schemas/Doctor'

    DoctorUpdateRequest:
      type: object
      description: Schema cho cập nhật thông tin bác sĩ (không bao gồm userId)
      properties:
        bio:
          type: string
          example: "Chuyên gia về sức khỏe sinh sản"
        experience:
          type: number
          example: 5
        rating:
          type: number
          minimum: 0
          maximum: 5
          example: 4.5
        specialization:
          type: string
          example: "Phụ khoa - Sinh sản"
        education:
          type: string
          example: "Thạc sĩ Y khoa - Đại học Y Dược"
        certificate:
          type: string
          example: "Chứng chỉ chuyên khoa cấp I"

    UserProfileRequest:
      type: object
      required:
        - fullName
        - gender
      properties:
        fullName:
          type: string
          example: "Nguyễn Văn A"
        gender:
          type: string
          enum: [male, female, other]
          example: "male"
        phone:
          type: string
          example: "0123456789"
        year:
          type: string
          format: date
          example: "1990-01-01"

    UserProfileUpdateRequest:
      type: object
      properties:
        fullName:
          type: string
          example: "Nguyễn Văn A"
        gender:
          type: string
          enum: [male, female, other]
          example: "male"
        phone:
          type: string
          example: "0123456789"
        year:
          type: string
          format: date
          example: "1990-01-01"

    Pagination:
      type: object
      properties:
        total:
          type: integer
        page:
          type: integer
          limit:
          type: integer
        totalPages:
          type: integer

    Appointment:
      type: object
      properties:
        _id:
          type: string
          example: "60d5ecb8b392e1b8c8f5c123"
        createdByUserId:
          type: string
          example: "60d5ecb8b392e1b8c8f5c124"
        profileId:
          type: object
          properties:
            _id:
              type: string
              example: "60d5ecb8b392e1b8c8f5c125"
            fullName:
              type: string
              example: "Nguyễn Văn A"
            gender:
              type: string
              example: "male"
            phone:
              type: string
              example: "0987654321"
            year:
              type: string
              format: date
              example: "1990-01-01"
        packageId:
          type: object
          properties:
            _id:
              type: string
              example: "60d5ecb8b392e1b8c8f5c126"
            name:
              type: string
              example: "Gói khám sức khỏe cơ bản"
            price:
              type: number
              example: 500000
        serviceId:
          type: object
          properties:
            _id:
              type: string
              example: "60d5ecb8b392e1b8c8f5c127"
            serviceName:
              type: string
              example: "Khám tổng quát"
            price:
              type: number
              example: 300000
            serviceType:
              type: string
              example: "consultation"
        slotId:
          type: string
          example: "60d5ecb8b392e1b8c8f5c128"
        appointmentDate:
          type: string
          format: date
          example: "2023-06-15"
        appointmentTime:
          type: string
          example: "14:30"
        appointmentType:
          type: string
          enum: [consultation, test, other]
          example: "consultation"
        typeLocation:
          type: string
          enum: [clinic, home, Online]
          example: "clinic"
        address:
          type: string
          example: "123 Đường ABC, Quận 1, TP.HCM"
        description:
          type: string
          example: "Khám sức khỏe định kỳ"
        notes:
          type: string
          example: "Tôi có tiền sử bệnh tim"
        status:
          type: string
          enum: [pending, confirmed, completed, cancelled]
          example: "pending"
        createdAt:
          type: string
          format: date-time
          example: "2023-06-10T07:30:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2023-06-10T07:30:00Z"


  /user-profiles:
    post:
      tags:
        - UserProfile
      summary: Tạo profile mới
      description: Tạo profile cho user đã đăng nhập. Mỗi user có thể có nhiều profiles.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserProfileRequest'
      responses:
        '201':
          description: Tạo profile thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/UserProfile'
        '400':
          description: Thiếu thông tin bắt buộc
        '401':
          description: Chưa xác thực

    get:
      tags:
        - Test Categories
      summary: Lấy danh sách danh mục xét nghiệm
      description: Lấy tất cả danh mục xét nghiệm có phân trang (Public access)
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Số trang
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Số lượng item mỗi trang
        - in: query
          name: search
          schema:
            type: string
          description: Tìm kiếm theo tên danh mục
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TestCategory'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Test Categories
      summary: Tạo danh mục xét nghiệm mới
      description: Tạo danh mục xét nghiệm mới (Chỉ Doctor/Nursing Staff)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - categoryName
                - description
              properties:
                categoryName:
                  type: string
                  description: Tên danh mục xét nghiệm
                  example: "Xét nghiệm máu tổng quát"
                description:
                  type: string
                  description: Mô tả danh mục
                  example: "Các xét nghiệm cơ bản về máu"
                isActive:
                  type: boolean
                  description: Trạng thái hoạt động
                  default: true
      responses:
        '201':
          description: Tạo danh mục thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestCategory'
                  message:
                    type: string
                    example: "Tạo danh mục xét nghiệm thành công"
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /test-categories/{id}:
    get:
      tags:
        - Test Categories
      summary: Lấy chi tiết danh mục xét nghiệm
      description: Lấy thông tin chi tiết danh mục xét nghiệm theo ID (Public access)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của danh mục xét nghiệm
      responses:
        '200':
          description: Lấy thông tin thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestCategory'
        '404':
          description: Không tìm thấy danh mục
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Test Categories
      summary: Cập nhật danh mục xét nghiệm
      description: Cập nhật thông tin danh mục xét nghiệm (Chỉ Doctor/Nursing Staff)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của danh mục xét nghiệm
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                categoryName:
                  type: string
                  description: Tên danh mục xét nghiệm
                  example: "Xét nghiệm máu tổng quát"
                description:
                  type: string
                  description: Mô tả danh mục
                  example: "Các xét nghiệm cơ bản về máu"
                isActive:
                  type: boolean
                  description: Trạng thái hoạt động
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestCategory'
                  message:
                    type: string
                    example: "Cập nhật danh mục xét nghiệm thành công"
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy danh mục
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Test Categories
      summary: Xóa danh mục xét nghiệm
      description: Xóa danh mục xét nghiệm (Chỉ Doctor/Nursing Staff)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của danh mục xét nghiệm
      responses:
        '200':
          description: Xóa thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Xóa danh mục xét nghiệm thành công"
        '404':
          description: Không tìm thấy danh mục
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ===== APPOINTMENT TESTS APIs =====
  /appointment-tests:
    get:
      tags:
        - Appointment Tests
      summary: Lấy danh sách đặt lịch xét nghiệm
      description: Lấy tất cả đặt lịch xét nghiệm với phân trang (Staff/Doctor)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Số trang
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Số lượng item mỗi trang
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, confirmed, in_progress, completed, cancelled]
          description: Lọc theo trạng thái
        - in: query
          name: patientName
          schema:
            type: string
          description: Tìm kiếm theo tên bệnh nhân
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AppointmentTest'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Appointment Tests
      summary: Tạo đặt lịch xét nghiệm mới
      description: Tạo đặt lịch xét nghiệm mới (Customer/Staff)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - price
                - patientName
                - phone
                - testDate
                - testCategoryIds
              properties:
                appointmentId:
                  type: string
                  description: ID của appointment (tùy chọn)
                  example: "none"
                  default: "none"
                name:
                  type: string
                  description: Tên xét nghiệm
                  example: "Xét nghiệm máu tổng quát"
                price:
                  type: number
                  description: Giá xét nghiệm (VND)
                  example: 150000
                  minimum: 0
                patientName:
                  type: string
                  description: Tên bệnh nhân
                  example: "Nguyễn Văn A"
                phone:
                  type: string
                  description: Số điện thoại
                  example: "0987654321"
                email:
                  type: string
                  description: Email liên hệ
                  example: "test@example.com"
                testDate:
                  type: string
                  format: date
                  description: Ngày xét nghiệm
                  example: "2024-01-20"
                testTime:
                  type: string
                  description: Giờ xét nghiệm
                  example: "08:00"
                testCategoryIds:
                  type: array
                  items:
                    type: string
                  description: Danh sách ID danh mục xét nghiệm
                  example: ["64a1b2c3d4e5f6g7h8i9j0k1"]
                notes:
                  type: string
                  description: Ghi chú
                  example: "Nhịn ăn 8 tiếng trước khi xét nghiệm"
      responses:
        '201':
          description: Tạo đặt lịch thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/AppointmentTest'
                  message:
                    type: string
                    example: "Đặt lịch xét nghiệm thành công"
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /appointment-tests/{id}:
    get:
      tags:
        - Appointment Tests
      summary: Lấy chi tiết đặt lịch xét nghiệm
      description: Lấy thông tin chi tiết đặt lịch xét nghiệm theo ID
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của đặt lịch xét nghiệm
      responses:
        '200':
          description: Lấy thông tin thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/AppointmentTest'
        '404':
          description: Không tìm thấy đặt lịch
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Appointment Tests
      summary: Cập nhật đặt lịch xét nghiệm
      description: Cập nhật thông tin đặt lịch xét nghiệm (Staff/Doctor)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của đặt lịch xét nghiệm
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                appointmentId:
                  type: string
                  description: ID của appointment (tùy chọn)
                  example: "none"
                name:
                  type: string
                  description: Tên xét nghiệm
                  example: "Xét nghiệm máu tổng quát"
                price:
                  type: number
                  description: Giá xét nghiệm (VND)
                  example: 150000
                  minimum: 0
                patientName:
                  type: string
                  description: Tên bệnh nhân
                phone:
                  type: string
                  description: Số điện thoại
                email:
                  type: string
                  description: Email liên hệ
                testDate:
                  type: string
                  format: date
                  description: Ngày xét nghiệm
                testTime:
                  type: string
                  description: Giờ xét nghiệm
                status:
                  type: string
                  enum: [pending, confirmed, in_progress, completed, cancelled]
                  description: Trạng thái đặt lịch
                notes:
                  type: string
                  description: Ghi chú
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/AppointmentTest'
                  message:
                    type: string
                    example: "Cập nhật đặt lịch xét nghiệm thành công"
        '404':
          description: Không tìm thấy đặt lịch
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Appointment Tests
      summary: Hủy đặt lịch xét nghiệm
      description: Hủy đặt lịch xét nghiệm (Customer/Staff)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của đặt lịch xét nghiệm
      responses:
        '200':
          description: Hủy đặt lịch thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Hủy đặt lịch xét nghiệm thành công"
        '404':
          description: Không tìm thấy đặt lịch
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ===== TEST RESULTS APIs =====
  /test-results:
    get:
      tags:
        - Test Results
      summary: Lấy danh sách kết quả xét nghiệm
      description: Lấy tất cả kết quả xét nghiệm với phân trang (Doctor/Staff)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Số trang
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Số lượng item mỗi trang
        - in: query
          name: patientName
          schema:
            type: string
          description: Tìm kiếm theo tên bệnh nhân
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, ready, delivered]
          description: Lọc theo trạng thái
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TestResult'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Test Results
      summary: Tạo kết quả xét nghiệm mới
      description: Tạo kết quả xét nghiệm mới (Doctor)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - appointmentTestId
                - testDate
              properties:
                appointmentTestId:
                  type: string
                  description: ID của đặt lịch xét nghiệm
                  example: "64a1b2c3d4e5f6g7h8i9j0k1"
                testDate:
                  type: string
                  format: date
                  description: Ngày thực hiện xét nghiệm
                  example: "2024-01-20"
                doctorNotes:
                  type: string
                  description: Ghi chú của bác sĩ
                  example: "Kết quả bình thường"
                conclusion:
                  type: string
                  description: Kết luận chung
                  example: "Không có bất thường"
      responses:
        '201':
          description: Tạo kết quả thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestResult'
                  message:
                    type: string
                    example: "Tạo kết quả xét nghiệm thành công"
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /test-results/{id}:
    get:
      tags:
        - Test Results
      summary: Lấy chi tiết kết quả xét nghiệm
      description: Lấy thông tin chi tiết kết quả xét nghiệm theo ID
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của kết quả xét nghiệm
      responses:
        '200':
          description: Lấy thông tin thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestResult'
        '404':
          description: Không tìm thấy kết quả xét nghiệm
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Test Results
      summary: Cập nhật kết quả xét nghiệm
      description: Cập nhật thông tin kết quả xét nghiệm (Doctor)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của kết quả xét nghiệm
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                testDate:
                  type: string
                  format: date
                  description: Ngày thực hiện xét nghiệm
                doctorNotes:
                  type: string
                  description: Ghi chú của bác sĩ
                conclusion:
                  type: string
                  description: Kết luận chung
                status:
                  type: string
                  enum: [pending, ready, delivered]
                  description: Trạng thái kết quả
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestResult'
                  message:
                    type: string
                    example: "Cập nhật kết quả xét nghiệm thành công"
        '404':
          description: Không tìm thấy kết quả xét nghiệm
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Test Results
      summary: Xóa kết quả xét nghiệm
      description: Xóa kết quả xét nghiệm (Doctor)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của kết quả xét nghiệm
      responses:
        '200':
          description: Xóa thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Xóa kết quả xét nghiệm thành công"
        '404':
          description: Không tìm thấy kết quả xét nghiệm
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ===== TEST RESULT ITEMS APIs =====
  /test-result-items:
    get:
      tags:
        - Test Result Items
      summary: Lấy danh sách chi tiết kết quả xét nghiệm
      description: Lấy tất cả chi tiết kết quả xét nghiệm (Doctor/Staff)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: testResultId
          schema:
            type: string
          description: Lọc theo ID kết quả xét nghiệm
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Số trang
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Số lượng item mỗi trang
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TestResultItem'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - Test Result Items
      summary: Tạo chi tiết kết quả xét nghiệm mới
      description: Tạo chi tiết kết quả xét nghiệm mới (Doctor)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - testResultId
                - testName
                - value
                - unit
                - normalRange
              properties:
                testResultId:
                  type: string
                  description: ID của kết quả xét nghiệm
                  example: "64a1b2c3d4e5f6g7h8i9j0k1"
                testName:
                  type: string
                  description: Tên xét nghiệm
                  example: "Hemoglobin"
                value:
                  type: string
                  description: Giá trị kết quả
                  example: "14.5"
                unit:
                  type: string
                  description: Đơn vị đo
                  example: "g/dL"
                normalRange:
                  type: string
                  description: Giá trị bình thường
                  example: "12.0 - 16.0"
                isAbnormal:
                  type: boolean
                  description: Có bất thường không
                  default: false
                notes:
                  type: string
                  description: Ghi chú
                  example: "Trong giới hạn bình thường"
      responses:
        '201':
          description: Tạo chi tiết thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestResultItem'
                  message:
                    type: string
                    example: "Tạo chi tiết kết quả xét nghiệm thành công"

  /test-result-items/{id}:
    get:
      tags:
        - Test Result Items
      summary: Lấy chi tiết kết quả xét nghiệm theo ID
      description: Lấy thông tin chi tiết kết quả xét nghiệm theo ID
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của chi tiết kết quả xét nghiệm
      responses:
        '200':
          description: Lấy thông tin thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestResultItem'
        '404':
          description: Không tìm thấy chi tiết kết quả xét nghiệm
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Test Result Items
      summary: Cập nhật chi tiết kết quả xét nghiệm
      description: Cập nhật thông tin chi tiết kết quả xét nghiệm (Doctor)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của chi tiết kết quả xét nghiệm
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                testName:
                  type: string
                  description: Tên xét nghiệm
                value:
                  type: string
                  description: Giá trị kết quả
                unit:
                  type: string
                  description: Đơn vị đo
                normalRange:
                  type: string
                  description: Giá trị bình thường
                isAbnormal:
                  type: boolean
                  description: Có bất thường không
                notes:
                  type: string
                  description: Ghi chú
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestResultItem'
                  message:
                    type: string
                    example: "Cập nhật chi tiết kết quả xét nghiệm thành công"
        '404':
          description: Không tìm thấy chi tiết kết quả xét nghiệm
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Test Result Items
      summary: Xóa chi tiết kết quả xét nghiệm
      description: Xóa chi tiết kết quả xét nghiệm (Doctor)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của chi tiết kết quả xét nghiệm
      responses:
        '200':
          description: Xóa thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Xóa chi tiết kết quả xét nghiệm thành công"
        '404':
          description: Không tìm thấy chi tiết kết quả xét nghiệm
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        fullName:
          type: string
        phone:
          type: string
        avatar:
          type: string
        role:
          type: string
          enum:
            - guest
            - customer
            - doctor
            - staff
            - manager
            - admin
        emailVerified:
          type: boolean
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    
    OtpCode:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        type:
          type: string
          enum:
            - email_verification
            - password_reset
            - login
        otp:
          type: string
        expires:
          type: string
          format: date-time
        verified:
          type: boolean
        verifiedAt:
          type: string
          format: date-time
        attempts:
          type: integer
        createdAt:
          type: string
          format: date-time
    
    Error:
      type: object
      properties:
        message:
          type: string


    LoginHistory:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        ipAddress:
          type: string
        userAgent:
          type: string
        loginAt:
          type: string
          format: date-time
        status:
          type: string
          enum: [success, failed]
        failReason:
          type: string

    Doctor:
      type: object
      properties:
        userId:
          type: string
        bio:
          type: string
        experience:
          type: number
        rating:
          type: number
        specialization:
          type: string
        education:
          type: string
        certificate:
          type: string

    # ===== DOCTOR SCHEDULE SCHEMAS =====
    TimeSlot:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        slotTime:
          type: string
          example: "07:00-08:00"
          description: Khung giờ làm việc
        status:
          type: string
          enum: [Free, Booked, Absent]
          example: "Free"
          description: Trạng thái slot - Free (trống), Booked (đã đặt), Absent (bác sĩ nghỉ)

    WeekSchedule:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439012"
        dayOfWeek:
          type: string
          format: date-time
          example: "2024-01-15T00:00:00.000Z"
          description: Ngày làm việc
        slots:
          type: array
          items:
            $ref: '#/components/schemas/TimeSlot'
          description: Danh sách 8 slot thời gian trong ngày

    DoctorSchedule:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439013"
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        weekSchedule:
          type: array
          items:
            $ref: '#/components/schemas/WeekSchedule'
          description: Lịch làm việc theo từng ngày
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    AvailableSlot:
      type: object
      properties:
        slotId:
          type: string
          example: "507f1f77bcf86cd799439011"
          description: ID của slot trống
        slotTime:
          type: string
          example: "07:00-08:00"
          description: Khung giờ trống
        status:
          type: string
          example: "Free"
          description: Luôn là Free vì chỉ trả về slot trống cho public

    AvailableDoctor:
      type: object
      properties:
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        doctorInfo:
          type: object
          properties:
            fullName:
              type: string
              example: "Dr. Nguyễn Văn A"
              description: Tên đầy đủ của bác sĩ
            specialization:
              type: string
              example: "Nội khoa"
              description: Chuyên khoa
        availableSlots:
          type: array
          items:
            $ref: '#/components/schemas/AvailableSlot'
          description: Danh sách slot trống

    DoctorPublicSchedule:
      type: object
      properties:
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        doctorInfo:
          type: object
          properties:
            fullName:
              type: string
              example: "Dr. Nguyễn Văn A"
              description: Tên đầy đủ của bác sĩ
            specialization:
              type: string
              example: "Nội khoa"
              description: Chuyên khoa
        weekSchedule:
          type: array
          items:
            type: object
            properties:
              dayOfWeek:
                type: string
                format: date-time
                example: "2024-01-15T00:00:00.000Z"
                description: Ngày làm việc
              availableSlots:
                type: array
                items:
                  $ref: '#/components/schemas/AvailableSlot'
                description: Danh sách slot trống trong ngày
          description: Lịch làm việc tuần với chỉ slot trống

    PublicDoctorDetails:
      type: object
      properties:
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        fullName:
          type: string
          example: "Dr. Nguyễn Văn A"
          description: Tên đầy đủ của bác sĩ
        email:
          type: string
          example: "doctor@email.com"
          description: Email của bác sĩ
        phone:
          type: string
          example: "0987654321"
          description: Số điện thoại
        specialization:
          type: string
          example: "Nội khoa"
          description: Chuyên khoa
        rating:
          type: number
          example: 4.5
          description: Đánh giá trung bình

    QnA:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439015"
        question:
          type: string
          example: "Câu hỏi về sức khỏe"
        answer:
          type: string
          example: "Trả lời từ bác sĩ"
        askedBy:
          type: string
          example: "507f1f77bcf86cd799439016"
          description: ID của người hỏi
        answeredBy:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ trả lời
        isPublic:
          type: boolean
          example: true
          description: Câu hỏi có công khai không
        category:
          type: string
          example: "Nội khoa"
          description: Danh mục câu hỏi
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PublicQnA:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439015"
        question:
          type: string
          example: "Câu hỏi về sức khỏe"
        answer:
          type: string
          example: "Trả lời từ bác sĩ"
        category:
          type: string
          example: "Nội khoa"
          description: Danh mục câu hỏi
        doctorInfo:
          type: object
          properties:
            fullName:
              type: string
              example: "Dr. Nguyễn Văn A"
            specialization:
              type: string
              example: "Nội khoa"
        createdAt:
          type: string
          format: date-time

    QnARequest:
      type: object
      required:
        - question
        - category
      properties:
        question:
          type: string
          example: "Tôi bị đau bụng, có nên uống thuốc gì không?"
        category:
          type: string
          example: "Nội khoa"

    QnAUpdateRequest:
      type: object
      properties:
        question:
          type: string
          example: "Tôi bị đau bụng, có nên uống thuốc gì không?"
        category:
          type: string
          example: "Nội khoa"
        isPublic:
          type: boolean
          example: true

    AnswerRequest:
      type: object
      required:
        - answer
      properties:
        answer:
          type: string
          example: "Bạn nên đến khám để bác sĩ chẩn đoán chính xác."
        isPublic:
          type: boolean
          example: true
          description: Có công khai câu trả lời không

    Service:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        price:
          type: number
        description:
          type: string
        image:
          type: string
          description: URL hình ảnh dịch vụ
          example: "https://example.com/service-image.jpg"
        type:
          type: string
        availableAt:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ServicePackage:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        image:
          type: string
          description: URL hình ảnh gói dịch vụ
          example: "https://example.com/package-image.jpg"
        priceBeforeDiscount:
          type: number
        price:
          type: number
        serviceIds:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer

    # ===== TEST SCHEMAS =====
    TestCategory:
      type: object
      properties:
        _id:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k1"
        categoryName:
          type: string
          example: "Xét nghiệm máu tổng quát"
        description:
          type: string
          example: "Các xét nghiệm cơ bản về máu"
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    AppointmentTest:
      type: object
      properties:
        _id:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k2"
        appointmentId:
          type: string
          example: "none"
        userId:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k3"
        patientName:
          type: string
          example: "Nguyễn Văn A"
        phone:
          type: string
          example: "0987654321"
        email:
          type: string
          example: "test@example.com"
        testDate:
          type: string
          format: date
          example: "2024-01-20"
        testTime:
          type: string
          example: "08:00"
        testCategories:
          type: array
          items:
            $ref: '#/components/schemas/TestCategory'
        status:
          type: string
          enum: [pending, confirmed, in_progress, completed, cancelled]
          example: "pending"
        notes:
          type: string
          example: "Nhịn ăn 8 tiếng trước khi xét nghiệm"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TestResult:
      type: object
      properties:
        _id:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k4"
        appointmentTest:
          $ref: '#/components/schemas/AppointmentTest'
        testDate:
          type: string
          format: date
          example: "2024-01-20"
        doctorId:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k5"
        doctorNotes:
          type: string
          example: "Kết quả bình thường"
        conclusion:
          type: string
          example: "Không có bất thường"
        status:
          type: string
          enum: [pending, ready, delivered]
          example: "ready"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TestResultItem:
      type: object
      properties:
        _id:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k6"
        testResultId:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k4"
        testName:
          type: string
          example: "Hemoglobin"
        value:
          type: string
          example: "14.5"
        unit:
          type: string
          example: "g/dL"
        normalRange:
          type: string
          example: "12.0 - 16.0"
        isAbnormal:
          type: boolean
          example: false
        notes:
          type: string
          example: "Trong giới hạn bình thường"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        fullName:
          type: string
        phone:
          type: string
        avatar:
          type: string
        role:
          type: string
          enum:
            - guest
            - customer
            - doctor
            - staff
            - manager
            - admin
        emailVerified:
          type: boolean
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    
    OtpCode:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        type:
          type: string
          enum:
            - email_verification
            - password_reset
            - login
        otp:
          type: string
        expires:
          type: string
          format: date-time
        verified:
          type: boolean
        verifiedAt:
          type: string
          format: date-time
        attempts:
          type: integer
        createdAt:
          type: string
          format: date-time
    
    Error:
      type: object
      properties:
        message:
          type: string
    
    LoginHistory:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        ipAddress:
          type: string
        userAgent:
          type: string
        loginAt:
          type: string
          format: date-time
        status:
          type: string
          enum: [success, failed]
        failReason:
          type: string

    Doctor:
      type: object
      properties:
        userId:
          type: string
        bio:
          type: string
        experience:
          type: number
        rating:
          type: number
        specialization:
          type: string
        education:
          type: string
        certificate:
          type: string

    # ===== DOCTOR SCHEDULE SCHEMAS =====
    TimeSlot:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        slotTime:
          type: string
          example: "07:00-08:00"
          description: Khung giờ làm việc
        status:
          type: string
          enum: [Free, Booked, Absent]
          example: "Free"
          description: Trạng thái slot - Free (trống), Booked (đã đặt), Absent (bác sĩ nghỉ)

    WeekSchedule:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439012"
        dayOfWeek:
          type: string
          format: date-time
          example: "2024-01-15T00:00:00.000Z"
          description: Ngày làm việc
        slots:
          type: array
          items:
            $ref: '#/components/schemas/TimeSlot'
          description: Danh sách 8 slot thời gian trong ngày

    DoctorSchedule:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439013"
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        weekSchedule:
          type: array
          items:
            $ref: '#/components/schemas/WeekSchedule'
          description: Lịch làm việc theo từng ngày
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    AvailableSlot:
      type: object
      properties:
        slotId:
          type: string
          example: "507f1f77bcf86cd799439011"
          description: ID của slot trống
        slotTime:
          type: string
          example: "07:00-08:00"
          description: Khung giờ trống
        status:
          type: string
          example: "Free"
          description: Luôn là Free vì chỉ trả về slot trống cho public

    AvailableDoctor:
      type: object
      properties:
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        doctorInfo:
          type: object
          properties:
            fullName:
              type: string
              example: "Dr. Nguyễn Văn A"
              description: Tên đầy đủ của bác sĩ
            specialization:
              type: string
              example: "Nội khoa"
              description: Chuyên khoa
        availableSlots:
          type: array
          items:
            $ref: '#/components/schemas/AvailableSlot'
          description: Danh sách slot trống

    DoctorPublicSchedule:
      type: object
      properties:
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        doctorInfo:
          type: object
          properties:
            fullName:
              type: string
              example: "Dr. Nguyễn Văn A"
              description: Tên đầy đủ của bác sĩ
            specialization:
              type: string
              example: "Nội khoa"
              description: Chuyên khoa
        weekSchedule:
          type: array
          items:
            type: object
            properties:
              dayOfWeek:
                type: string
                format: date-time
                example: "2024-01-15T00:00:00.000Z"
                description: Ngày làm việc
              availableSlots:
                type: array
                items:
                  $ref: '#/components/schemas/AvailableSlot'
                description: Danh sách slot trống trong ngày
          description: Lịch làm việc tuần với chỉ slot trống

    PublicDoctorDetails:
      type: object
      properties:
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        fullName:
          type: string
          example: "Dr. Nguyễn Văn A"
          description: Tên đầy đủ của bác sĩ
        email:
          type: string
          example: "doctor@email.com"
          description: Email của bác sĩ
        phone:
          type: string
          example: "0987654321"
          description: Số điện thoại
        specialization:
          type: string
          example: "Nội khoa"
          description: Chuyên khoa
        rating:
          type: number
          example: 4.5
          description: Đánh giá trung bình

    QnA:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439015"
        question:
          type: string
          example: "Câu hỏi về sức khỏe"
        answer:
          type: string
          example: "Trả lời từ bác sĩ"
        askedBy:
          type: string
          example: "507f1f77bcf86cd799439016"
          description: ID của người hỏi
        answeredBy:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ trả lời
        isPublic:
          type: boolean
          example: true
          description: Câu hỏi có công khai không
        category:
          type: string
          example: "Nội khoa"
          description: Danh mục câu hỏi
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PublicQnA:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439015"
        question:
          type: string
          example: "Câu hỏi về sức khỏe"
        answer:
          type: string
          example: "Trả lời từ bác sĩ"
        category:
          type: string
          example: "Nội khoa"
          description: Danh mục câu hỏi
        doctorInfo:
          type: object
          properties:
            fullName:
              type: string
              example: "Dr. Nguyễn Văn A"
            specialization:
              type: string
              example: "Nội khoa"
        createdAt:
          type: string
          format: date-time

    QnARequest:
      type: object
      required:
        - question
        - category
      properties:
        question:
          type: string
          example: "Tôi bị đau bụng, có nên uống thuốc gì không?"
        category:
          type: string
          example: "Nội khoa"

    QnAUpdateRequest:
      type: object
      properties:
        question:
          type: string
          example: "Tôi bị đau bụng, có nên uống thuốc gì không?"
        category:
          type: string
          example: "Nội khoa"
        isPublic:
          type: boolean
          example: true

    AnswerRequest:
      type: object
      required:
        - answer
      properties:
        answer:
          type: string
          example: "Bạn nên đến khám để bác sĩ chẩn đoán chính xác."
        isPublic:
          type: boolean
          example: true
          description: Có công khai câu trả lời không

    Service:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        price:
          type: number
        description:
          type: string
        image:
          type: string
          description: URL hình ảnh dịch vụ
          example: "https://example.com/service-image.jpg"
        type:
          type: string
        availableAt:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ServicePackage:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        image:
          type: string
          description: URL hình ảnh gói dịch vụ
          example: "https://example.com/package-image.jpg"
        priceBeforeDiscount:
          type: number
        price:
          type: number
        serviceIds:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer

    # ===== TEST SCHEMAS =====
    TestCategory:
      type: object
      properties:
        _id:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k1"
        categoryName:
          type: string
          example: "Xét nghiệm máu tổng quát"
        description:
          type: string
          example: "Các xét nghiệm cơ bản về máu"
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    
    AppointmentTest:
      type: object
      properties:
        _id:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k2"
        userId:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k3"
        appointmentId:
          type: string
          example: "none"
        patientName:
          type: string
          example: "Nguyễn Văn A"
        phone:
          type: string
          example: "0987654321"
        email:
          type: string
          example: "test@example.com"
        testDate:
          type: string
          format: date
          example: "2024-01-20"
        testTime:
          type: string
          example: "08:00"
        testCategories:
          type: array
          items:
            $ref: '#/components/schemas/TestCategory'
        status:
          type: string
          enum: [pending, confirmed, in_progress, completed, cancelled]
          example: "pending"
        notes:
          type: string
          example: "Nhịn ăn 8 tiếng trước khi xét nghiệm"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TestResult:
      type: object
      properties:
        _id:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k4"
        appointmentTest:
          $ref: '#/components/schemas/AppointmentTest'
        testDate:
          type: string
          format: date
          example: "2024-01-20"
        doctorId:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k5"
        doctorNotes:
          type: string
          example: "Kết quả bình thường"
        conclusion:
          type: string
          example: "Không có bất thường"
        status:
          type: string
          enum: [pending, ready, delivered]
          example: "ready"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    
    TestResultItem:
      type: object
      properties:
        _id:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k6"
        testResultId:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k4"
        testName:
          type: string
          example: "Hemoglobin"
        value:
          type: string
          example: "14.5"
        unit:
          type: string
          example: "g/dL"
        normalRange:
          type: string
          example: "12.0 - 16.0"
        isAbnormal:
          type: boolean
          example: false
        notes:
          type: string
          example: "Trong giới hạn bình thường"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      responses:
        '200':
          description: Tìm bác sĩ có lịch trống thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Tìm thấy 3 bác sĩ có lịch trống trong ngày 2024-01-15"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AvailableDoctor'
                  searchCriteria:
                    type: object
                    properties:
                      date:
                        type: string
                        example: "2024-01-15"
                      timeSlot:
                        type: string
                        example: "07:00-08:00"
                      totalFound:
                        type: integer
                        example: 3
        '400':
          description: Thiếu tham số date
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ===== STAFF ONLY ROUTES (cần xác thực + staff role) =====

  /doctors/schedules/all/staff:
    get:
      tags:
        - Doctor Schedules
      summary: Staff xem tất cả lịch làm việc của tất cả bác sĩ (STAFF/MANAGER/ADMIN)
      description: Staff/Manager/Admin xem tất cả lịch làm việc của tất cả bác sĩ với mọi status (Free, Booked, Absent)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lấy tất cả lịch làm việc thành công (tất cả status)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy tất cả lịch làm việc thành công (tất cả status) - Tìm thấy 5 bác sĩ có lịch làm việc"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DoctorSchedule'
                  totalDoctorsWithSchedules:
                    type: integer
                    example: 5
                    description: Tổng số bác sĩ có lịch làm việc
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff/manager/admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/statistics/all:
    get:
      tags:
        - Doctor Schedules
      summary: Lấy thống kê tất cả bác sĩ (STAFF/MANAGER/ADMIN)
      description: Lấy thống kê tổng hợp của tất cả bác sĩ bao gồm số slot đã đặt, vắng mặt và số ngày nghỉ
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lấy thống kê tất cả bác sĩ thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy thống kê thành công cho 5 bác sĩ"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DoctorStatistics'
                  summary:
                    type: object
                    properties:
                      totalDoctors:
                        type: integer
                        example: 5
                        description: Tổng số bác sĩ
                      totalBookedSlots:
                        type: integer
                        example: 50
                        description: Tổng số slot đã được đặt của tất cả bác sĩ
                      totalAbsentSlots:
                        type: integer
                        example: 15
                        description: Tổng số slot vắng mặt của tất cả bác sĩ
                      totalAbsentDays:
                        type: integer
                        example: 8
                        description: Tổng số ngày nghỉ của tất cả bác sĩ
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff/manager/admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/available/staff:
    get:
      tags:
        - Doctor Schedules
      summary: Staff xem tất cả bác sĩ và slots theo ngày (STAFF/MANAGER/ADMIN)
      description: Staff/Manager/Admin xem tất cả bác sĩ và slots với mọi status (Free, Booked, Absent) trong ngày cụ thể
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: date
          required: true
          schema:
            type: string
            format: date
          example: "2024-01-15"
          description: Ngày cần xem bác sĩ (YYYY-MM-DD)
        - in: query
          name: timeSlot
          required: false
          schema:
            type: string
          example: "07:00-08:00"
          description: Khung giờ cụ thể (tuỳ chọn)
      responses:
        '200':
          description: Xem tất cả bác sĩ thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Tìm thấy 5 bác sĩ trong ngày 2024-01-15 (tất cả status)"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/StaffAvailableDoctor'
                  searchCriteria:
                    type: object
                    properties:
                      date:
                        type: string
                        example: "2024-01-15"
                      timeSlot:
                        type: string
                        example: "Tất cả khung giờ"
                      totalFound:
                        type: integer
                        example: 5
                      viewType:
                        type: string
                        example: "staff"
        '400':
          description: Thiếu tham số date
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/{id}/schedules/staff:
    get:
      tags:
        - Doctor Schedules
      summary: Staff xem tất cả lịch làm việc của bác sĩ (STAFF/MANAGER/ADMIN)
      description: Staff/Manager/Admin xem tất cả lịch làm việc với mọi status (Free, Booked, Absent)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của bác sĩ
      responses:
        '200':
          description: Lấy tất cả lịch làm việc thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy tất cả lịch làm việc thành công (tất cả status)"
                  data:
                    $ref: '#/components/schemas/DoctorSchedule'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Bác sĩ chưa có lịch làm việc nào
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/{id}/available-slots/staff:
    get:
      tags:
        - Doctor Schedules
      summary: Staff xem tất cả slots theo ngày (STAFF/MANAGER/ADMIN)
      description: Staff/Manager/Admin xem tất cả slots với mọi status (Free, Booked, Absent) của bác sĩ trong ngày cụ thể
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của bác sĩ
        - in: query
          name: date
          required: true
          schema:
            type: string
            format: date
          example: "2024-01-15"
          description: Ngày cần xem slots (YYYY-MM-DD)
      responses:
        '200':
          description: Lấy tất cả slots thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Tìm thấy 8 slots trong ngày 2024-01-15 (tất cả status)"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/StaffSlot'
        '400':
          description: Thiếu tham số date
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/{id}/statistics:
    get:
      tags:
        - Doctor Schedules
      summary: Lấy thống kê bác sĩ (STAFF/MANAGER/ADMIN)
      description: Lấy thống kê chi tiết về bác sĩ bao gồm số slot đã đặt, vắng mặt và số ngày nghỉ
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của bác sĩ
      responses:
        '200':
          description: Lấy thống kê bác sĩ thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy thống kê bác sĩ thành công"
                  data:
                    $ref: '#/components/schemas/DoctorStatistics'
        '400':
          description: Thiếu ID bác sĩ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/{id}/schedules:
    post:
      tags:
        - Doctor Schedules
      summary: Tạo lịch làm việc cho bác sĩ (STAFF/MANAGER/ADMIN)
      description: Staff/Manager/Admin tạo lịch làm việc cho bác sĩ theo ngày - tự động tạo 8 slots cố định với status Free
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của bác sĩ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - date
              properties:
                date:
                  type: string
                  format: date
                  example: "2024-01-15"
                  description: Ngày làm việc (YYYY-MM-DD)
      responses:
        '201':
          description: Tạo lịch làm việc thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Tạo lịch làm việc thành công! Đã tạo 8 slots từ 7h-17h"
                  data:
                    $ref: '#/components/schemas/DoctorSchedule'
        '400':
          description: Lỗi dữ liệu đầu vào hoặc ngày đã có lịch
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Doctor Schedules
      summary: Cập nhật trạng thái slot (STAFF/MANAGER/ADMIN)
      description: Cập nhật status của slot thời gian cụ thể (Free/Booked/Absent)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của bác sĩ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - date
                - slotId
                - status
              properties:
                date:
                  type: string
                  format: date
                  example: "2024-01-15"
                slotId:
                  type: string
                  example: "507f1f77bcf86cd799439011"
                  description: ID của slot cần cập nhật
                status:
                  type: string
                  enum: [Free, Booked, Absent]
                  example: "Booked"
                  description: Trạng thái mới của slot
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Đặt lịch thành công"
                  data:
                    $ref: '#/components/schemas/DoctorSchedule'
        '400':
          description: Lỗi dữ liệu đầu vào hoặc status không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/{id}/schedules/{scheduleId}:
    delete:
      tags:
        - Doctor Schedules
      summary: Xóa lịch làm việc của một ngày (MANAGER ONLY)
      description: Manager set tất cả slots trong ngày thành status Absent thay vì xóa cứng khỏi database
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của bác sĩ
        - in: path
          name: scheduleId
          required: true
          schema:
            type: string
          description: ID của schedule ngày cần xóa
      responses:
        '200':
          description: Xóa lịch thành công (set thành Absent)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Xóa lịch làm việc thành công - Đã đánh dấu bác sĩ nghỉ toàn bộ ngày (tất cả slots = Absent)"
                  data:
                    $ref: '#/components/schemas/DoctorSchedule'
        '400':
          description: Lỗi khi xóa
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy lịch để xóa
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/{id}/book-slot:
    post:
      tags:
        - Doctor Schedules
      summary: Book slot cho customer (MANAGER ONLY)
      description: Manager book slot cho customer khi nhận cuộc gọi đặt lịch tư vấn - chuyển slot từ Free thành Booked
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của bác sĩ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - date
                - slotId
              properties:
                date:
                  type: string
                  format: date
                  example: "2024-01-15"
                  description: Ngày đặt lịch (YYYY-MM-DD)
                slotId:
                  type: string
                  example: "507f1f77bcf86cd799439011"
                  description: ID của slot cần book
      responses:
        '200':
          description: Book slot thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Đặt lịch thành công cho customer!"
                  data:
                    $ref: '#/components/schemas/DoctorSchedule'
                  bookingInfo:
                    type: object
                    properties:
                      doctorId:
                        type: string
                        example: "507f1f77bcf86cd799439014"
                      date:
                        type: string
                        example: "2024-01-15"
                      slotId:
                        type: string
                        example: "507f1f77bcf86cd799439011"
                      status:
                        type: string
                        example: "Booked"
        '400':
          description: Lỗi dữ liệu đầu vào hoặc slot không available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ manager)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # =============== DOCTOR QA APIs ===============
  
  # PUBLIC ROUTES
  /doctor-qa/least-booked-doctor:
    get:
      tags:
        - Doctor QA
      summary: "[STAFF/MANAGER/ADMIN] Tìm bác sĩ có ít lịch đặt nhất"
      description: Staff/Manager/Admin tìm bác sĩ có số slot đã đặt ít nhất để tự động phân công
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Tìm bác sĩ thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Tìm bác sĩ có ít lịch đặt nhất thành công"
                  data:
                    type: object
                    properties:
                      doctorId:
                        type: string
                        example: "675e4bcd6dc1234567890abc"
                        description: ID của bác sĩ có ít lịch đặt nhất
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff/manager/admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  # USER ROUTES (requires authentication)
  /doctor-qa:
    post:
      tags:
        - Doctor QA
      summary: "[USER] Tạo yêu cầu tư vấn mới"
      description: User tạo yêu cầu tư vấn với bác sĩ. Có thể chọn bác sĩ cụ thể hoặc để hệ thống tự động phân công
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - fullName
                - phone
                - question
              properties:
                doctorId:
                  type: string
                  description: ID bác sĩ (không bắt buộc - nếu không có sẽ auto-assign)
                  example: "675e4bcd6dc1234567890abc"
                fullName:
                  type: string
                  description: Họ tên người yêu cầu tư vấn
                  example: "Nguyễn Văn A"
                phone:
                  type: string
                  description: Số điện thoại liên hệ
                  example: "0987654321"
                question:
                  type: string
                  description: Câu hỏi/vấn đề cần tư vấn
                  example: "Tôi bị đau bụng thường xuyên, có phải bệnh gì không?"
                notes:
                  type: string
                  description: Ghi chú thêm (không bắt buộc)
                  example: "Triệu chứng kéo dài 2 tuần"
      responses:
        '201':
          description: Tạo yêu cầu tư vấn thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Tạo yêu cầu tư vấn thành công! Vui lòng thanh toán để hoàn tất."
                  data:
                    $ref: '#/components/schemas/DoctorQA'
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    
    get:
      tags:
        - Doctor QA
      summary: "[STAFF/MANAGER/ADMIN] Lấy tất cả yêu cầu tư vấn"
      description: Staff/Manager/Admin xem tất cả yêu cầu tư vấn trong hệ thống, có thể filter theo status
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [pending_payment, paid, doctor_confirmed, scheduled, consulting, completed, cancelled]
          description: Lọc theo trạng thái
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy danh sách yêu cầu tư vấn thành công (15 yêu cầu)"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DoctorQA'
                  summary:
                    type: object
                    properties:
                      total:
                        type: integer
                        example: 15
                      filter:
                        type: object
        '403':
          description: Không có quyền (chỉ staff)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctor-qa/my-requests:
    get:
      tags:
        - Doctor QA
      summary: "[USER] Lấy yêu cầu tư vấn của tôi"
      description: User xem tất cả yêu cầu tư vấn của mình
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy danh sách yêu cầu tư vấn của bạn thành công (3 yêu cầu)"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DoctorQA'

  /doctor-qa/{id}:
    get:
      tags:
        - Doctor QA
      summary: "[USER/STAFF/DOCTOR] Lấy chi tiết yêu cầu tư vấn"
      description: Xem chi tiết một yêu cầu tư vấn theo ID
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của yêu cầu tư vấn
      responses:
        '200':
          description: Lấy thông tin thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy thông tin yêu cầu tư vấn thành công"
                  data:
                    $ref: '#/components/schemas/DoctorQA'
        '404':
          description: Không tìm thấy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctor-qa/doctor/{doctorId}:
    get:
      tags:
        - Doctor QA
      summary: "[DOCTOR/STAFF] Lấy yêu cầu tư vấn của bác sĩ"
      description: Xem tất cả yêu cầu tư vấn được giao cho bác sĩ cụ thể
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: doctorId
          required: true
          schema:
            type: string
          description: ID của bác sĩ
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy danh sách yêu cầu tư vấn của bác sĩ thành công (5 yêu cầu)"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DoctorQA'

  /doctor-qa/{id}/payment:
    put:
      tags:
        - Doctor QA
      summary: "[PAYMENT GATEWAY] Cập nhật trạng thái thanh toán"
      description: Webhook từ payment gateway để cập nhật trạng thái thanh toán
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của yêu cầu tư vấn
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - paymentSuccess
              properties:
                paymentSuccess:
                  type: boolean
                  description: Kết quả thanh toán
                  example: true
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Thanh toán thành công! Yêu cầu tư vấn đã được gửi đến bác sĩ."
                  data:
                    $ref: '#/components/schemas/DoctorQA'
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctor-qa/{id}/confirm:
    put:
      tags:
        - Doctor QA
      summary: "[DOCTOR] Bác sĩ xác nhận/từ chối tư vấn"
      description: Bác sĩ xác nhận hoặc từ chối yêu cầu tư vấn đã được thanh toán
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của yêu cầu tư vấn
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - action
              properties:
                action:
                  type: string
                  enum: [confirm, reject]
                  description: Hành động của bác sĩ
                  example: "confirm"
      responses:
        '200':
          description: Xác nhận thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Bác sĩ đã xác nhận nhận tư vấn. Staff sẽ sắp xếp lịch cụ thể."
                  data:
                    $ref: '#/components/schemas/DoctorQA'
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctor-qa/{id}/schedule:
    put:
      tags:
        - Doctor QA
      summary: "[STAFF] Xếp lịch tư vấn tự động"
      description: Staff chỉ cần nhấn button để tự động tìm slot gần nhất và đặt lịch cho user. Hệ thống sẽ tự động tìm slot Free sớm nhất của bác sĩ (hoặc auto-assign doctor nếu chưa có) và book luôn.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của yêu cầu tư vấn
      responses:
        '200':
          description: Xếp lịch tự động thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Xếp lịch tư vấn tự động thành công!"
                  data:
                    $ref: '#/components/schemas/DoctorQA'
                  autoScheduleInfo:
                    type: object
                    properties:
                      doctorId:
                        type: string
                        example: "675e4bcd6dc1234567890abc"
                        description: ID bác sĩ được chọn
                      appointmentDate:
                        type: string
                        format: date
                        example: "2024-01-20"
                        description: Ngày hẹn được tự động chọn
                      appointmentSlot:
                        type: string
                        example: "07:00-08:00"
                        description: Khung giờ được tự động chọn
                      slotId:
                        type: string
                        example: "675e4bcd6dc1234567890def"
                        description: ID slot đã được book
                      message:
                        type: string
                        example: "Đã tự động đặt lịch slot gần nhất: 07:00-08:00 ngày 2024-01-20"
                        description: Thông báo chi tiết về lịch đã đặt
        '400':
          description: Dữ liệu không hợp lệ hoặc không tìm thấy slot trống
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctor-qa/{id}/status:
    put:
      tags:
        - Doctor QA
      summary: "[STAFF/DOCTOR] Cập nhật trạng thái tư vấn"
      description: Cập nhật trạng thái yêu cầu tư vấn (consulting, completed, cancelled...)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của yêu cầu tư vấn
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [pending_payment, paid, doctor_confirmed, scheduled, consulting, completed, cancelled]
                  description: Trạng thái mới
                  example: "consulting"
                doctorNotes:
                  type: string
                  description: Ghi chú của bác sĩ (không bắt buộc)
                  example: "Đã tư vấn xong, khuyên nên khám thêm"
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Cập nhật trạng thái yêu cầu tư vấn thành công"
                  data:
                    $ref: '#/components/schemas/DoctorQA'
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctor-qa/{id}:
    delete:
      tags:
        - Doctor QA
      summary: "[STAFF/MANAGER/ADMIN] Xóa yêu cầu tư vấn"
      description: Staff/Manager/Admin xóa yêu cầu tư vấn (chỉ những yêu cầu chưa thanh toán hoặc đã hủy)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của yêu cầu tư vấn
      responses:
        '200':
          description: Xóa thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Xóa yêu cầu tư vấn thành công"
                  data:
                    $ref: '#/components/schemas/DoctorQA'
        '404':
          description: Không tìm thấy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff/manager/admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/{id}/schedules/bulk:
    post:
      tags:
        - Doctor Schedules
      summary: Tạo lịch hàng loạt cho bác sĩ (STAFF/MANAGER/ADMIN)
      description: Tạo lịch làm việc hàng loạt cho bác sĩ với nhiều time slots trong một ngày
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của bác sĩ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - date
                - timeSlots
              properties:
                date:
                  type: string
                  format: date
                  example: "2024-01-15"
                  description: Ngày làm việc (YYYY-MM-DD)
                timeSlots:
                  type: array
                  items:
                    type: string
                  example: ["08:00", "09:00", "10:00", "11:00", "14:00", "15:00", "16:00", "17:00"]
                  description: Mảng các khung giờ làm việc
            examples:
              full_day:
                summary: Tạo lịch cả ngày
                value:
                  date: "2024-01-15"
                  timeSlots: ["08:00", "09:00", "10:00", "11:00", "14:00", "15:00", "16:00", "17:00"]
              morning_only:
                summary: Chỉ tạo lịch buổi sáng
                value:
                  date: "2024-01-15"
                  timeSlots: ["08:00", "09:00", "10:00", "11:00"]
      responses:
        '201':
          description: Tạo lịch hàng loạt thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Tạo lịch thành công cho 8 time slots"
                  data:
                    $ref: '#/components/schemas/DoctorSchedule'
        '400':
          description: Lỗi dữ liệu đầu vào (ngày không hợp lệ, time slots trống)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff/manager/admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Lịch làm việc đã tồn tại cho ngày này
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/{id}/schedules/bulk-days:
    post:
      tags:
        - Doctor Schedules
      summary: Tạo lịch hàng loạt cho nhiều ngày cụ thể (MANAGER ONLY)
      description: Manager tạo lịch làm việc cho bác sĩ trong nhiều ngày cùng lúc - mỗi ngày sẽ tự động tạo 8 slots với status Free
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của bác sĩ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - dates
              properties:
                dates:
                  type: array
                  items:
                    type: string
                    format: date
                  example: ["2024-01-15", "2024-01-16", "2024-01-17"]
                  description: Mảng các ngày làm việc (YYYY-MM-DD) - tối đa 31 ngày
            examples:
              multiple_dates:
                summary: Tạo lịch cho nhiều ngày
                value:
                  dates: ["2024-01-15", "2024-01-16", "2024-01-17", "2024-01-18", "2024-01-19"]
      responses:
        '201':
          description: Tạo lịch hàng loạt thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Tạo lịch thành công cho 4/5 ngày"
                  data:
                    type: object
                    properties:
                      success:
                        type: boolean
                        example: true
                      totalRequested:
                        type: integer
                        example: 5
                      successCount:
                        type: integer
                        example: 4
                      errorCount:
                        type: integer
                        example: 1
                      results:
                        type: array
                        items:
                          type: object
                          properties:
                            date:
                              type: string
                              example: "2024-01-15"
                            success:
                              type: boolean
                              example: true
                            schedule:
                              $ref: '#/components/schemas/DoctorSchedule'
                      errors:
                        type: array
                        items:
                          type: string
                        example: ["Lịch làm việc đã tồn tại cho ngày 2024-01-16"]
        '400':
          description: Lỗi dữ liệu đầu vào (mảng dates trống, quá 31 ngày, format ngày sai)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/{id}/schedules/bulk-month:
    post:
      tags:
        - Doctor Schedules
      summary: Tạo lịch hàng loạt cho cả tháng - trừ T7, CN (MANAGER ONLY)
      description: Manager tạo lịch làm việc cho bác sĩ trong cả tháng - tự động loại bỏ thứ 7, chủ nhật và tạo lịch cho các ngày làm việc
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của bác sĩ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - month
                - year
              properties:
                month:
                  type: integer
                  minimum: 1
                  maximum: 12
                  example: 6
                  description: Tháng (1-12)
                year:
                  type: integer
                  minimum: 2024
                  maximum: 2030
                  example: 2025
                  description: Năm (2024-2030)
            examples:
              june_2025:
                summary: Tạo lịch cho tháng 6/2025
                value:
                  month: 6
                  year: 2025
      responses:
        '201':
          description: Tạo lịch hàng loạt cho cả tháng thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Tạo lịch thành công cho tháng 6/2025: 20/22 ngày làm việc (đã loại bỏ 8 ngày cuối tuần)"
                  data:
                    type: object
                    properties:
                      success:
                        type: boolean
                        example: true
                      totalRequested:
                        type: integer
                        example: 22
                      successCount:
                        type: integer
                        example: 20
                      errorCount:
                        type: integer
                        example: 2
                      month:
                        type: integer
                        example: 6
                      year:
                        type: integer
                        example: 2025
                      totalWorkingDays:
                        type: integer
                        example: 22
                        description: Tổng số ngày làm việc trong tháng
                      weekendsExcluded:
                        type: integer
                        example: 8
                        description: Số ngày cuối tuần đã loại bỏ
                      results:
                        type: array
                        items:
                          type: object
                          properties:
                            date:
                              type: string
                              example: "2025-06-02"
                            success:
                              type: boolean
                              example: true
                            schedule:
                              $ref: '#/components/schemas/DoctorSchedule'
                      errors:
                        type: array
                        items:
                          type: string
                        example: ["Lịch làm việc đã tồn tại cho ngày 2025-06-03"]
        '400':
          description: Lỗi dữ liệu đầu vào (month không hợp lệ, year ngoài phạm vi)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /doctors/{id}/book-slot:
    post:
      tags:
        - Doctor Schedules
      summary: Book slot cho customer (STAFF ONLY)
      description: Staff book slot cho customer khi nhận cuộc gọi đặt lịch tư vấn - chuyển slot từ Free thành Booked
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của bác sĩ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - date
                - slotId
              properties:
                date:
                  type: string
                  format: date
                  example: "2024-01-15"
                  description: Ngày đặt lịch (YYYY-MM-DD)
                slotId:
                  type: string
                  example: "507f1f77bcf86cd799439011"
                  description: ID của slot cần book
      responses:
        '200':
          description: Book slot thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Đặt lịch thành công cho customer!"
                  data:
                    $ref: '#/components/schemas/DoctorSchedule'
                  bookingInfo:
                    type: object
                    properties:
                      doctorId:
                        type: string
                        example: "507f1f77bcf86cd799439014"
                      date:
                        type: string
                        example: "2024-01-15"
                      slotId:
                        type: string
                        example: "507f1f77bcf86cd799439011"
                      status:
                        type: string
                        example: "Booked"
        '400':
          description: Lỗi dữ liệu đầu vào hoặc slot không available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ staff)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ===== TEST CATEGORIES APIs =====
  /test-categories:
    get:
      tags:
        - Test Categories
      summary: Lấy danh sách danh mục xét nghiệm
      description: Lấy tất cả danh mục xét nghiệm có phân trang (Public access)
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Số trang
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Số lượng item mỗi trang
        - in: query
          name: search
          schema:
            type: string
          description: Tìm kiếm theo tên danh mục
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TestCategory'
                  pagination:
                      $ref: '#/components/schemas/Pagination'
        '500':
          description: Lỗi server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Test Categories
      summary: Tạo danh mục xét nghiệm mới
      description: Tạo danh mục xét nghiệm mới (Chỉ Doctor/Nursing Staff)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - categoryName
                - description
              properties:
                categoryName:
                  type: string
                  description: Tên danh mục xét nghiệm
                  example: "Xét nghiệm máu tổng quát"
                description:
                  type: string
                  description: Mô tả danh mục
                  example: "Các xét nghiệm cơ bản về máu"
                isActive:
                  type: boolean
                  description: Trạng thái hoạt động
                  default: true
      responses:
        '201':
          description: Tạo danh mục thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestCategory'
                  message:
                    type: string
                    example: "Tạo danh mục xét nghiệm thành công"
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /test-categories/{id}:
    get:
      tags:
        - Test Categories
      summary: Lấy chi tiết danh mục xét nghiệm
      description: Lấy thông tin chi tiết danh mục xét nghiệm theo ID (Public access)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của danh mục xét nghiệm
      responses:
        '200':
          description: Lấy thông tin thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestCategory'
        '404':
          description: Không tìm thấy danh mục
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Test Categories
      summary: Cập nhật danh mục xét nghiệm
      description: Cập nhật thông tin danh mục xét nghiệm (Chỉ Doctor/Nursing Staff)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của danh mục xét nghiệm
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                categoryName:
                  type: string
                  description: Tên danh mục xét nghiệm
                  example: "Xét nghiệm máu tổng quát"
                description:
                  type: string
                  description: Mô tả danh mục
                  example: "Các xét nghiệm cơ bản về máu"
                isActive:
                  type: boolean
                  description: Trạng thái hoạt động
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestCategory'
                  message:
                    type: string
                    example: "Cập nhật danh mục xét nghiệm thành công"
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Không tìm thấy danh mục
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Test Categories
      summary: Xóa danh mục xét nghiệm
      description: Xóa danh mục xét nghiệm (Chỉ Doctor/Nursing Staff)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của danh mục xét nghiệm
      responses:
        '200':
          description: Xóa thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Xóa danh mục xét nghiệm thành công"
        '404':
          description: Không tìm thấy danh mục
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'



  # ===== TEST RESULTS APIs =====
  /test-results:
    get:
      tags:
        - Test Results
      summary: Lấy danh sách kết quả xét nghiệm
      description: Lấy tất cả kết quả xét nghiệm với phân trang (Doctor/Staff)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Số trang
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Số lượng item mỗi trang
        - in: query
          name: patientName
          schema:
            type: string
          description: Tìm kiếm theo tên bệnh nhân
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, ready, delivered]
          description: Lọc theo trạng thái
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TestResult'
                  pagination:
                      $ref: '#/components/schemas/Pagination'
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền truy cập
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - Test Results
      summary: Tạo kết quả xét nghiệm mới
      description: Tạo kết quả xét nghiệm mới (Doctor)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - appointmentTestId
                - testDate
              properties:
                appointmentTestId:
                  type: string
                  description: ID của đặt lịch xét nghiệm
                  example: "64a1b2c3d4e5f6g7h8i9j0k1"
                testDate:
                  type: string
                  format: date
                  description: Ngày thực hiện xét nghiệm
                  example: "2024-01-20"
                doctorNotes:
                  type: string
                  description: Ghi chú của bác sĩ
                  example: "Kết quả bình thường"
                conclusion:
                  type: string
                  description: Kết luận chung
                  example: "Không có bất thường"
      responses:
        '201':
          description: Tạo kết quả thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestResult'
                  message:
                    type: string
                    example: "Tạo kết quả xét nghiệm thành công"
        '400':
          description: Dữ liệu không hợp lệ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /test-results/{id}:
    get:
      tags:
        - Test Results
      summary: Lấy chi tiết kết quả xét nghiệm
      description: Lấy thông tin chi tiết kết quả xét nghiệm theo ID
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của kết quả xét nghiệm
      responses:
        '200':
          description: Lấy thông tin thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestResult'
        '404':
          description: Không tìm thấy kết quả xét nghiệm
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Test Results
      summary: Cập nhật kết quả xét nghiệm
      description: Cập nhật thông tin kết quả xét nghiệm (Doctor)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của kết quả xét nghiệm
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                testDate:
                  type: string
                  format: date
                  description: Ngày thực hiện xét nghiệm
                doctorNotes:
                  type: string
                  description: Ghi chú của bác sĩ
                conclusion:
                  type: string
                  description: Kết luận chung
                status:
                  type: string
                  enum: [pending, ready, delivered]
                  description: Trạng thái kết quả
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestResult'
                  message:
                    type: string
                    example: "Cập nhật kết quả xét nghiệm thành công"
        '404':
          description: Không tìm thấy kết quả xét nghiệm
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Test Results
      summary: Xóa kết quả xét nghiệm
      description: Xóa kết quả xét nghiệm (Doctor)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của kết quả xét nghiệm
      responses:
        '200':
          description: Xóa thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Xóa kết quả xét nghiệm thành công"
        '404':
          description: Không tìm thấy kết quả xét nghiệm
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ===== TEST RESULT ITEMS APIs =====
  /test-result-items:
    get:
      tags:
        - Test Result Items
      summary: Lấy danh sách chi tiết kết quả xét nghiệm
      description: Lấy tất cả chi tiết kết quả xét nghiệm (Doctor/Staff)
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: testResultId
          schema:
            type: string
          description: Lọc theo ID kết quả xét nghiệm
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Số trang
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Số lượng item mỗi trang
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TestResultItem'
                  pagination:
                      $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - Test Result Items
      summary: Tạo chi tiết kết quả xét nghiệm mới
      description: Tạo chi tiết kết quả xét nghiệm mới (Doctor)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - testResultId
                - testName
                - value
                - unit
                - normalRange
              properties:
                testResultId:
                  type: string
                  description: ID của kết quả xét nghiệm
                  example: "64a1b2c3d4e5f6g7h8i9j0k1"
                testName:
                  type: string
                  description: Tên xét nghiệm
                  example: "Hemoglobin"
                value:
                  type: string
                  description: Giá trị kết quả
                  example: "14.5"
                unit:
                  type: string
                  description: Đơn vị đo
                  example: "g/dL"
                normalRange:
                  type: string
                  description: Giá trị bình thường
                  example: "12.0 - 16.0"
                isAbnormal:
                  type: boolean
                  description: Có bất thường không
                  default: false
                notes:
                  type: string
                  description: Ghi chú
                  example: "Trong giới hạn bình thường"
      responses:
        '201':
          description: Tạo chi tiết thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestResultItem'
                  message:
                    type: string
                    example: "Tạo chi tiết kết quả xét nghiệm thành công"

  /test-result-items/{id}:
    get:
      tags:
        - Test Result Items
      summary: Lấy chi tiết kết quả xét nghiệm theo ID
      description: Lấy thông tin chi tiết kết quả xét nghiệm theo ID
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của chi tiết kết quả xét nghiệm
      responses:
        '200':
          description: Lấy thông tin thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestResultItem'
        '404':
          description: Không tìm thấy chi tiết kết quả xét nghiệm
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Test Result Items
      summary: Cập nhật chi tiết kết quả xét nghiệm
      description: Cập nhật thông tin chi tiết kết quả xét nghiệm (Doctor)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của chi tiết kết quả xét nghiệm
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                testName:
                  type: string
                  description: Tên xét nghiệm
                value:
                  type: string
                  description: Giá trị kết quả
                unit:
                  type: string
                  description: Đơn vị đo
                normalRange:
                  type: string
                  description: Giá trị bình thường
                isAbnormal:
                  type: boolean
                  description: Có bất thường không
                notes:
                  type: string
                  description: Ghi chú
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/TestResultItem'
                  message:
                    type: string
                    example: "Cập nhật chi tiết kết quả xét nghiệm thành công"
        '404':
          description: Không tìm thấy chi tiết kết quả xét nghiệm
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Test Result Items
      summary: Xóa chi tiết kết quả xét nghiệm
      description: Xóa chi tiết kết quả xét nghiệm (Doctor)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID của chi tiết kết quả xét nghiệm
      responses:
        '200':
          description: Xóa thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Xóa chi tiết kết quả xét nghiệm thành công"
        '404':
          description: Không tìm thấy chi tiết kết quả xét nghiệm
        content:
          application/json:
            schema:
                $ref: '#/components/schemas/Error'

  # =============== MEDICAL RECORDS APIs ===============
  
  /medical-records:
    post:
      tags:
        - Medical Records
      summary: "[DOCTOR/STAFF/MANAGER/ADMIN] Tạo hồ sơ khám bệnh"
      description: Doctor/Staff/Manager/Admin tạo hồ sơ khám bệnh sau khi khám cho bệnh nhân. Có thể chọn thuốc từ danh sách medicines master data.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - profileId
                - appointmentId
              properties:
                profileId:
                  type: string
                  example: "675e4bcd6dc1234567890123"
                  description: ID hồ sơ bệnh nhân
                appointmentId:
                  type: string
                  example: "675e4bcd6dc1234567890456"
                  description: ID cuộc hẹn khám
                diagnosis:
                  type: string
                  example: "Viêm dạ dày"
                  description: Chẩn đoán bệnh
                symptoms:
                  type: string
                  example: "Đau bụng, buồn nôn"
                  description: Triệu chứng
                treatment:
                  type: string
                  example: "Uống thuốc theo đơn, kiêng cay"
                  description: Phương pháp điều trị
                medicines:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                        example: "Paracetamol"
                      type:
                        type: string
                        example: "Giảm đau"
                      dosage:
                        type: string
                        example: "500mg"
                      frequency:
                        type: string
                        example: "3 lần/ngày"
                      timingInstructions:
                        type: string
                        example: "Sau ăn 30 phút"
                      duration:
                        type: string
                        example: "7 ngày"
                      instructions:
                        type: string
                        example: "Uống đủ liều, không bỏ"
                  description: Danh sách thuốc kê đơn
                notes:
                  type: string
                  example: "Tái khám sau 1 tuần"
                  description: Ghi chú thêm
                pictures:
                  type: array
                  items:
                    type: string
                  example: ["url1.jpg", "url2.jpg"]
                  description: Hình ảnh kèm theo
      responses:
        '201':
          description: Tạo hồ sơ khám bệnh thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Tạo hồ sơ khám bệnh thành công"
                  data:
                    $ref: '#/components/schemas/MedicalRecord'

  /medical-records/{id}:
    put:
      tags:
        - Medical Records
      summary: "[DOCTOR/STAFF] Cập nhật hồ sơ khám bệnh"
      description: Doctor chỉ sửa được hồ sơ do mình tạo, Staff sửa được tất cả
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID hồ sơ khám bệnh
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                diagnosis:
                  type: string
                symptoms:
                  type: string
                treatment:
                  type: string
                medicines:
                  type: array
                  items:
                    type: object
                notes:
                  type: string
                pictures:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Cập nhật hồ sơ khám bệnh thành công"
                  data:
                    $ref: '#/components/schemas/MedicalRecord'
    
    get:
      tags:
        - Medical Records
      summary: "[ALL] Xem chi tiết hồ sơ khám bệnh"
      description: Doctor xem hồ sơ do mình tạo, Staff xem tất cả, Customer xem hồ sơ của mình
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID hồ sơ khám bệnh
      responses:
        '200':
          description: Lấy thông tin thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy thông tin hồ sơ khám bệnh thành công"
                  data:
                    $ref: '#/components/schemas/MedicalRecord'

  /medical-records/my/records:
    get:
      tags:
        - Medical Records
      summary: "[DOCTOR] Xem hồ sơ do mình tạo"
      description: Doctor xem danh sách hồ sơ khám bệnh do mình tạo
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
        - in: query
          name: profileId
          schema:
            type: string
          description: Lọc theo hồ sơ bệnh nhân
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/MedicalRecord'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /medical-records/staff/all:
    get:
      tags:
        - Medical Records
      summary: "[STAFF] Xem tất cả hồ sơ khám bệnh"
      description: Staff/Manager/Admin xem tất cả hồ sơ khám bệnh trong hệ thống
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
        - in: query
          name: doctorId
          schema:
            type: string
          description: Lọc theo bác sĩ
        - in: query
          name: profileId
          schema:
            type: string
          description: Lọc theo hồ sơ bệnh nhân
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Lấy tất cả hồ sơ thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/MedicalRecord'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /medical-records/profile/{profileId}:
    get:
      tags:
        - Medical Records
      summary: "[CUSTOMER] Xem hồ sơ khám của profile"
      description: User xem hồ sơ khám bệnh của profiles thuộc về mình
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: profileId
          required: true
          schema:
            type: string
          description: ID hồ sơ bệnh nhân
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
        - in: query
          name: doctorId
          schema:
            type: string
          description: Lọc theo bác sĩ
      responses:
        '200':
          description: Lấy hồ sơ khám bệnh thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/MedicalRecord'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /medical-records/my/search:
    get:
      tags:
        - Medical Records
      summary: "[DOCTOR] Tìm kiếm hồ sơ do mình tạo"
      description: Doctor tìm kiếm trong hồ sơ khám bệnh do mình tạo
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: diagnosis
          schema:
            type: string
          description: Tìm theo chẩn đoán
        - in: query
          name: patientName
          schema:
            type: string
          description: Tìm theo tên bệnh nhân
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Tìm kiếm thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/MedicalRecord'
                  searchCriteria:
                    type: object

  /medical-records/staff/search:
    get:
      tags:
        - Medical Records
      summary: "[STAFF] Tìm kiếm tất cả hồ sơ"
      description: Staff tìm kiếm trong tất cả hồ sơ khám bệnh
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: diagnosis
          schema:
            type: string
          description: Tìm theo chẩn đoán
        - in: query
          name: doctorName
          schema:
            type: string
          description: Tìm theo tên bác sĩ
        - in: query
          name: patientName
          schema:
            type: string
          description: Tìm theo tên bệnh nhân
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Tìm kiếm thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/MedicalRecord'
                  searchCriteria:
                    type: object

  # =============== MEDICINES APIs ===============
  
  /medicines:
    post:
      tags:
        - Medicines
      summary: "[MANAGER/ADMIN] Tạo thuốc mới"
      description: Chỉ Manager hoặc Admin có quyền tạo thuốc trong master data
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - type
              properties:
                name:
                  type: string
                  example: "Paracetamol"
                  description: Tên thuốc
                type:
                  type: string
                  example: "Giảm đau, hạ sốt"
                  description: Loại thuốc
                description:
                  type: string
                  example: "Thuốc giảm đau, hạ sốt thông dụng"
                  description: Mô tả thuốc
                defaultDosage:
                  type: string
                  example: "500mg"
                  description: Liều lượng mặc định
                defaultTimingInstructions:
                  type: string
                  example: "Sau ăn 30 phút"
                  description: Hướng dẫn sử dụng mặc định
      responses:
        '201':
          description: Tạo thuốc thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Tạo thuốc thành công"
                  data:
                    $ref: '#/components/schemas/Medicine'
    
    get:
      tags:
        - Medicines
      summary: "[DOCTOR/STAFF/MANAGER/ADMIN] Lấy danh sách thuốc"
      description: Doctor/Staff/Manager/Admin xem thuốc đang hoạt động để kê đơn và quản lý. Customer KHÔNG được xem - họ chỉ xem thuốc từ medical records của mình.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: type
          schema:
            type: string
            enum: ["contraceptive", "vitamin", "other", "antibiotic", "painkiller"]
          description: Lọc theo loại thuốc (tuỳ chọn)
          example: "painkiller"
      responses:
        '200':
          description: Lấy danh sách thuốc thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy danh sách thuốc thành công (5 thuốc)"
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                        name:
                          type: string
                          example: "Paracetamol"
                        type:
                          type: string
                          example: "painkiller"
                        description:
                          type: string
                          example: "Thuốc giảm đau, hạ sốt"
                        defaultDosage:
                          type: string
                          example: "500mg"
                        defaultTimingInstructions:
                          type: string
                          example: "Sau ăn 30 phút"
        '401':
          description: Chưa xác thực
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Không có quyền (chỉ Doctor/Staff/Manager/Admin)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /medicines/{id}:
    get:
      tags:
        - Medicines
      summary: "[ALL ROLES EXCEPT GUEST] Xem chi tiết thuốc"
      description: Tất cả roles trừ guest có thể xem thông tin chi tiết của một loại thuốc
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID thuốc
      responses:
        '200':
          description: Lấy thông tin thuốc thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy thông tin thuốc thành công"
                  data:
                    $ref: '#/components/schemas/Medicine'
    
    put:
      tags:
        - Medicines
      summary: "[MANAGER/ADMIN] Cập nhật thuốc"
      description: Chỉ Manager hoặc Admin có quyền cập nhật thông tin thuốc
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID thuốc
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                type:
                  type: string
                description:
                  type: string
                defaultDosage:
                  type: string
                defaultTimingInstructions:
                  type: string
                isActive:
                  type: boolean
      responses:
        '200':
          description: Cập nhật thuốc thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Cập nhật thuốc thành công"
                  data:
                    $ref: '#/components/schemas/Medicine'

  /medicines/{id}/status:
    patch:
      tags:
        - Medicines
      summary: "[MANAGER/ADMIN] Kích hoạt/vô hiệu hóa thuốc"
      description: Manager hoặc Admin thay đổi trạng thái hoạt động của thuốc
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID thuốc
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - isActive
              properties:
                isActive:
                  type: boolean
                  description: Trạng thái hoạt động mới
      responses:
        '200':
          description: Thay đổi trạng thái thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/Medicine'

  # =============== MEDICATION REMINDERS APIs ===============
  
  /medication-reminders:
    post:
      tags:
        - Medication Reminders
      summary: "[CUSTOMER] Tạo nhắc nhở từ hồ sơ khám"
      description: User tạo nhắc nhở uống thuốc từ hồ sơ khám bệnh, chọn thuốc và thiết lập lịch nhắc
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - medicalRecordId
                - profileId
                - selectedMedicines
              properties:
                medicalRecordId:
                  type: string
                  example: "675e4bcd6dc1234567890123"
                  description: ID hồ sơ khám bệnh
                profileId:
                  type: string
                  example: "675e4bcd6dc1234567890456"
                  description: ID hồ sơ bệnh nhân
                selectedMedicines:
                  type: array
                  items:
                    type: object
                    properties:
                      medicineIndex:
                        type: integer
                        example: 0
                        description: Index thuốc trong medical record
                      reminderTimes:
                        type: array
                        items:
                          type: string
                        example: ["08:00", "14:00", "20:00"]
                        description: Giờ nhắc nhở
                      frequency:
                        type: string
                        example: "daily"
                        description: Tần suất
                      customInstructions:
                        type: string
                        example: "Uống sau ăn"
                        description: Hướng dẫn riêng
                  description: Danh sách thuốc được chọn để nhắc
                startDate:
                  type: string
                  format: date
                  example: "2024-01-20"
                  description: Ngày bắt đầu nhắc
                endDate:
                  type: string
                  format: date
                  example: "2024-01-27"
                  description: Ngày kết thúc nhắc (optional)
                notes:
                  type: string
                  example: "Nhắc uống thuốc theo đơn bác sĩ"
                  description: Ghi chú thêm
      responses:
        '201':
          description: Tạo nhắc nhở thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Tạo nhắc nhở uống thuốc thành công"
                  data:
                    $ref: '#/components/schemas/MedicationReminder'

  /medication-reminders/my:
    get:
      tags:
        - Medication Reminders
      summary: "[CUSTOMER] Xem nhắc nhở của tôi"
      description: User xem danh sách nhắc nhở uống thuốc của profiles thuộc về mình
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: profileId
          schema:
            type: string
          description: Lọc theo hồ sơ bệnh nhân
        - in: query
          name: isActive
          schema:
            type: boolean
          description: Lọc theo trạng thái hoạt động
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Lấy danh sách nhắc nhở thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/MedicationReminder'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /medication-reminders/{id}:
    get:
      tags:
        - Medication Reminders
      summary: "[CUSTOMER] Xem chi tiết nhắc nhở"
      description: User xem chi tiết nhắc nhở uống thuốc của mình
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID nhắc nhở
      responses:
        '200':
          description: Lấy thông tin nhắc nhở thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy thông tin nhắc nhở thành công"
                  data:
                    $ref: '#/components/schemas/MedicationReminder'
    
    put:
      tags:
        - Medication Reminders
      summary: "[CUSTOMER] Cập nhật nhắc nhở"
      description: User cập nhật thông tin nhắc nhở uống thuốc của mình
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID nhắc nhở
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                medicines:
                  type: array
                  items:
                    type: object
                  description: Danh sách thuốc và lịch nhắc
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
                isActive:
                  type: boolean
                notes:
                  type: string
      responses:
        '200':
          description: Cập nhật nhắc nhở thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Cập nhật nhắc nhở thành công"
                  data:
                    $ref: '#/components/schemas/MedicationReminder'
    
    delete:
      tags:
        - Medication Reminders
      summary: "[CUSTOMER] Xóa nhắc nhở"
      description: User xóa nhắc nhở uống thuốc của mình
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID nhắc nhở
      responses:
        '200':
          description: Xóa nhắc nhở thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Xóa nhắc nhở thành công"
                  data:
                    $ref: '#/components/schemas/MedicationReminder'

  /medication-reminders/{id}/status:
    patch:
      tags:
        - Medication Reminders
      summary: "[CUSTOMER] Tạm dừng/kích hoạt nhắc nhở"
      description: User tạm dừng hoặc kích hoạt lại nhắc nhở uống thuốc
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID nhắc nhở
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - isActive
              properties:
                isActive:
                  type: boolean
                  description: Trạng thái hoạt động mới
      responses:
        '200':
          description: Thay đổi trạng thái thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: '#/components/schemas/MedicationReminder'

  /medication-reminders/staff/all:
    get:
      tags:
        - Medication Reminders
      summary: "[STAFF/MANAGER/ADMIN] Xem tất cả nhắc nhở"
      description: Staff/Manager/Admin xem tổng quan tất cả nhắc nhở trong hệ thống
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: profileId
          schema:
            type: string
          description: Lọc theo hồ sơ bệnh nhân
        - in: query
          name: userId
          schema:
            type: string
          description: Lọc theo user
        - in: query
          name: isActive
          schema:
            type: boolean
          description: Lọc theo trạng thái hoạt động
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Lấy tất cả nhắc nhở thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/MedicationReminder'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  # =============== NOTIFICATION DAYS APIs ===============
  
  /notification-days/{id}:
    put:
      tags:
        - Notification Days
      summary: "[CUSTOMER] Cập nhật trạng thái thông báo"
      description: User cập nhật trạng thái thông báo nhắc uống thuốc (taken, skipped, snoozed)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID thông báo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [pending, sent, failed, taken, skipped, snoozed]
                  example: "taken"
                  description: Trạng thái mới
                reason:
                  type: string
                  example: "Đã uống đúng giờ"
                  description: Lý do (tuỳ chọn)
                takenAt:
                  type: string
                  format: date-time
                  description: Thời gian uống (nếu status = taken)
                snoozedUntil:
                  type: string
                  format: date-time
                  description: Hoãn đến lúc (nếu status = snoozed)
      responses:
        '200':
          description: Cập nhật trạng thái thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Cập nhật trạng thái thông báo thành công"
                  data:
                    $ref: '#/components/schemas/NotificationDay'

  /notification-days/my:
    get:
      tags:
        - Notification Days
      summary: "[CUSTOMER] Xem thông báo của tôi"
      description: User xem tất cả thông báo nhắc uống thuốc của mình
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: reminderId
          schema:
            type: string
          description: Lọc theo nhắc nhở cụ thể
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, sent, failed, taken, skipped, snoozed]
          description: Lọc theo trạng thái
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Lấy danh sách thông báo thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/NotificationDay'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /notification-days/reminder/{reminderId}:
    get:
      tags:
        - Notification Days
      summary: "[CUSTOMER] Xem thông báo theo nhắc nhở"
      description: User xem tất cả thông báo của một nhắc nhở cụ thể
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: reminderId
          required: true
          schema:
            type: string
          description: ID nhắc nhở
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, sent, failed, taken, skipped, snoozed]
          description: Lọc theo trạng thái
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Lấy thông báo của nhắc nhở thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/NotificationDay'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /notification-days/{id}/taken:
    patch:
      tags:
        - Notification Days
      summary: "[CUSTOMER] Đánh dấu đã uống thuốc"
      description: User đánh dấu đã uống thuốc theo lịch nhắc
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID thông báo
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  example: "Đã uống đúng giờ"
                  description: Lý do (tuỳ chọn)
      responses:
        '200':
          description: Đánh dấu đã uống thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Đánh dấu đã uống thuốc thành công"
                  data:
                    $ref: '#/components/schemas/NotificationDay'

  /notification-days/{id}/skipped:
    patch:
      tags:
        - Notification Days
      summary: "[CUSTOMER] Bỏ qua lần uống"
      description: User đánh dấu bỏ qua lần uống thuốc này
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID thông báo
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  example: "Quên mang thuốc"
                  description: Lý do bỏ qua
      responses:
        '200':
          description: Đánh dấu bỏ qua thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Đánh dấu bỏ qua lần uống thành công"
                  data:
                    $ref: '#/components/schemas/NotificationDay'

  /notification-days/{id}/snooze:
    patch:
      tags:
        - Notification Days
      summary: "[CUSTOMER] Hoãn thông báo"
      description: User hoãn thông báo nhắc uống thuốc đến thời gian khác
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID thông báo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - snoozedUntil
              properties:
                snoozedUntil:
                  type: string
                  format: date-time
                  example: "2024-01-20T15:30:00.000Z"
                  description: Thời gian hoãn đến
                reason:
                  type: string
                  example: "Đang bận, sẽ uống sau"
                  description: Lý do hoãn
      responses:
        '200':
          description: Hoãn thông báo thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Hoãn thông báo thành công"
                  data:
                    $ref: '#/components/schemas/NotificationDay'

  /notification-days/staff/all:
    get:
      tags:
        - Notification Days
      summary: "[STAFF] Xem tất cả thông báo"
      description: Staff/Manager/Admin xem tổng quan tất cả thông báo trong hệ thống
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: reminderId
          schema:
            type: string
          description: Lọc theo nhắc nhở
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, sent, failed, taken, skipped, snoozed]
          description: Lọc theo trạng thái
        - in: query
          name: userId
          schema:
            type: string
          description: Lọc theo user
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Lấy tất cả thông báo thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/NotificationDay'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /notification-days/staff/statistics:
    get:
      tags:
        - Notification Days
      summary: "[STAFF] Lấy thống kê thông báo"
      description: Staff xem thống kê về hiệu quả nhắc nhở uống thuốc
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
          description: Từ ngày
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
          description: Đến ngày
        - in: query
          name: reminderId
          schema:
            type: string
          description: Lọc theo nhắc nhở cụ thể
      responses:
        '200':
          description: Lấy thống kê thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy thống kê thông báo thành công"
                  data:
                    type: object
                    properties:
                      totalNotifications:
                        type: integer
                        example: 150
                      takenCount:
                        type: integer
                        example: 120
                      skippedCount:
                        type: integer
                        example: 20
                      snoozedCount:
                        type: integer
                        example: 10
                      complianceRate:
                        type: number
                        example: 80.0
                        description: Tỷ lệ tuân thủ uống thuốc (%)
                      period:
                        type: object
                        properties:
                          from:
                            type: string
                            format: date
                          to:
                            type: string
                            format: date

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  
  schemas:
    User:
     type: object
     properties:
        id:
          type: string
        email:
          type: string
        fullName:
          type: string
        phone:
          type: string
        avatar:
          type: string
        role:
          type: string
          enum:
            - guest
            - customer
            - doctor
            - staff
            - manager
            - admin
        emailVerified:
          type: boolean
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    
    OtpCode:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        type:
          type: string
          enum:
            - email_verification
            - password_reset
            - login
        otp:
          type: string
        expires:
          type: string
          format: date-time
        verified:
          type: boolean
        verifiedAt:
          type: string
          format: date-time
        attempts:
          type: integer
        createdAt:
          type: string
          format: date-time
    
    Error:
      type: object
      properties:
        message:
          type: string

    LoginHistory:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        ipAddress:
          type: string
        userAgent:
          type: string
        loginAt:
          type: string
          format: date-time
        status:
          type: string
          enum: [success, failed]
        failReason:
          type: string

    Doctor:
      type: object
      properties:
        userId:
          type: string
        bio:
          type: string
        experience:
          type: number
        rating:
          type: number
        specialization:
          type: string
        education:
          type: string
        certificate:
          type: string


    # ===== DOCTOR SCHEDULE SCHEMAS =====
    TimeSlot:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        slotTime:
          type: string
          example: "07:00-08:00"
          description: Khung giờ làm việc
        status:
          type: string
          enum: [Free, Booked, Absent]
          example: "Free"
          description: Trạng thái slot - Free (trống), Booked (đã đặt), Absent (bác sĩ nghỉ)

    WeekSchedule:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439012"
        dayOfWeek:
          type: string
          format: date-time
          example: "2024-01-15T00:00:00.000Z"
          description: Ngày làm việc
        slots:
          type: array
          items:
            $ref: '#/components/schemas/TimeSlot'
          description: Danh sách 8 slot thời gian trong ngày

    DoctorSchedule:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439013"
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        weekSchedule:
          type: array
          items:
            $ref: '#/components/schemas/WeekSchedule'
          description: Lịch làm việc theo từng ngày
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    AvailableSlot:
      type: object
      properties:
        slotId:
          type: string
          example: "507f1f77bcf86cd799439011"
          description: ID của slot trống
        slotTime:
          type: string
          example: "07:00-08:00"
          description: Khung giờ trống
        status:
          type: string
          example: "Free"
          description: Luôn là Free vì chỉ trả về slot trống cho public

    AvailableDoctor:
      type: object
      properties:
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        doctorInfo:
          type: object
          properties:
            fullName:
              type: string
              example: "Dr. Nguyễn Văn A"
            email:
              type: string
              example: "dr.nguyen@genderhealthcare.com"
            avatar:
              type: string
              example: "https://example.com/avatar.jpg"
            specialization:
              type: string
              example: "Nội khoa"
            experience:
              type: number
              example: 5
            rating:
              type: number
              example: 4.5
        availableSlots:
          type: array
          description: Danh sách slot Free của bác sĩ (chỉ public)
          items:
            $ref: '#/components/schemas/AvailableSlot'
        totalAvailableSlots:
          type: integer
          example: 3

    StaffSlot:
      type: object
      properties:
        slotId:
          type: string
          example: "507f1f77bcf86cd799439011"
          description: ID của slot
        slotTime:
          type: string
          example: "07:00-08:00"
          description: Khung giờ
        status:
          type: string
          enum: [Free, Booked, Absent]
          example: "Booked"
          description: Trạng thái slot cho staff xem

    StaffAvailableDoctor:
      type: object
      properties:
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        doctorInfo:
          type: object
          properties:
            fullName:
              type: string
              example: "Dr. Nguyễn Văn A"
            email:
              type: string
              example: "dr.nguyen@genderhealthcare.com"
            avatar:
              type: string
              example: "https://example.com/avatar.jpg"
            specialization:
              type: string
              example: "Nội khoa"
            experience:
              type: number
              example: 5
            rating:
              type: number
              example: 4.5
        availableSlots:
          type: array
          items:
            $ref: '#/components/schemas/StaffSlot'
          description: Danh sách tất cả slots của bác sĩ (cho staff)
        totalAvailableSlots:
          type: integer
          example: 8
          description: Tổng số slots

    DoctorStatistics:
      type: object
      properties:
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        name:
          type: string
          example: "Dr. Nguyễn Văn A"
          description: Tên bác sĩ
        bookedSlots:
          type: integer
          example: 15
          description: Tổng số slot đã được đặt (status Booked)
        absentSlots:
          type: integer
          example: 5
          description: Tổng số slot vắng mặt lẻ (status Absent) - không tính slot đã thành ngày nghỉ
        absentDays:
          type: integer
          example: 2
          description: Số ngày nghỉ (mỗi ngày có đủ 8 slot Absent = 1 ngày nghỉ)

    LeastBookedDoctor:
      type: object
      properties:
        doctorId:
          type: string
          example: "507f1f77bcf86cd799439014"
          description: ID của bác sĩ
        name:
          type: string
          example: "Dr. Nguyễn Văn A"
          description: Tên bác sĩ
        bookedSlots:
          type: integer
          example: 3
          description: Số slot đã được đặt
        absentSlots:
          type: integer
          example: 1
          description: Số slot vắng mặt lẻ
        absentDays:
          type: integer
          example: 0
          description: Số ngày nghỉ

    DoctorQA:
      type: object
      properties:
        _id:
          type: string
          example: "675e4bcd6dc1234567890123"
          description: ID của yêu cầu tư vấn
        doctorId:
          type: object
          properties:
            _id:
              type: string
              example: "675e4bcd6dc1234567890abc"
            userId:
              type: object
              properties:
                _id:
                  type: string
                  example: "675e4bcd6dc1234567890def"
                fullName:
                  type: string
                  example: "Dr. Nguyễn Văn A"
                email:
                  type: string
                  example: "dr.nguyen@genderhealthcare.com"
            bio:
              type: string
              example: "Bác sĩ chuyên khoa Nội"
            specialization:
              type: string
              example: "Nội khoa"
        userId:
          type: object
          properties:
            _id:
              type: string
              example: "675e4bcd6dc1234567890ghi"
            fullName:
              type: string
              example: "Nguyễn Văn B"
            email:
              type: string
              example: "user@example.com"
        fullName:
          type: string
          example: "Nguyễn Văn B"
          description: Họ tên người yêu cầu tư vấn
        phone:
          type: string
          example: "0987654321"
          description: Số điện thoại liên hệ
        question:
          type: string
          example: "Tôi bị đau bụng thường xuyên, có phải bệnh gì không?"
          description: Câu hỏi/vấn đề cần tư vấn
        notes:
          type: string
          example: "Triệu chứng kéo dài 2 tuần"
          description: Ghi chú thêm
        status:
          type: string
          enum: [pending_payment, paid, doctor_confirmed, scheduled, consulting, completed, cancelled]
          example: "pending_payment"
          description: Trạng thái yêu cầu tư vấn
        consultationFee:
          type: number
          example: 200000
          description: Phí tư vấn (VND)
        appointmentDate:
          type: string
          format: date-time
          example: "2024-01-20T00:00:00.000Z"
          description: Ngày hẹn tư vấn
        appointmentSlot:
          type: string
          example: "14:00-15:00"
          description: Khung giờ tư vấn
        slotId:
          type: string
          example: "675e4bcd6dc1234567890jkl"
          description: ID của slot đã book
        doctorNotes:
          type: string
          example: "Đã tư vấn xong, khuyên nên khám thêm"
          description: Ghi chú của bác sĩ
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00.000Z"
          description: Thời gian tạo yêu cầu
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-15T14:45:00.000Z"
          description: Thời gian cập nhật cuối

    # =============== NEW SCHEMAS FOR 4 MODULES ===============
    
    MedicalRecord:
    DoctorWithUser:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        doctor:
          $ref: '#/components/schemas/Doctor'

    DoctorUpdateRequest:
      type: object
      description: Schema cho cập nhật thông tin bác sĩ (không bao gồm userId)
      properties:
        bio:
          type: string
          example: "Chuyên gia về sức khỏe sinh sản"
        experience:
          type: number
          example: 5
        rating:
          type: number
          minimum: 0
          maximum: 5
          example: 4.5
        specialization:
          type: string
          example: "Phụ khoa - Sinh sản"
        education:
          type: string
          example: "Thạc sĩ Y khoa - Đại học Y Dược"
        certificate:
          type: string
          example: "Chứng chỉ chuyên khoa cấp I"

    Pagination:
      type: object
      properties:
        total:
          type: integer
        page:
          type: integer
          limit:
          type: integer
          totalPages:
          type: integer

    Appointment:
      type: object
      properties:
        _id:
          type: string
          example: "675e4bcd6dc1234567890123"
          description: ID hồ sơ khám bệnh
        doctorId:
          type: object
          properties:
            _id:
              type: string
            userId:
              type: object
              properties:
                fullName:
                  type: string
                  example: "Dr. Nguyễn Văn A"
                email:
                  type: string
          example: "60d5ecb8b392e1b8c8f5c123"
        createdByUserId:
          type: string
          example: "60d5ecb8b392e1b8c8f5c124"
        profileId:
          type: object
          properties:
            _id:
              type: string
            fullName:
              type: string
              example: "Nguyễn Thị B"
            gender:
              type: string
              example: "female"
            phone:
              type: string
              example: "0987654321"
        appointmentId:
          type: object
          properties:
            _id:
              type: string
              example: "60d5ecb8b392e1b8c8f5c125"
            fullName:
              type: string
              example: "Nguyễn Văn A"
            gender:
              type: string
              example: "male"
            phone:
              type: string
              example: "0987654321"
            year:
              type: string
              format: date
              example: "1990-01-01"
        packageId:
          type: object
          properties:
            _id:
              type: string
            appointmentDate:
              type: string
              format: date
            appointmentTime:
              type: string
              example: "14:00-15:00"
            status:
              type: string
        diagnosis:
          type: string
          example: "Viêm dạ dày"
          description: Chẩn đoán bệnh
        symptoms:
          type: string
          example: "Đau bụng, buồn nôn"
          description: Triệu chứng
        treatment:
          type: string
          example: "Uống thuốc theo đơn, kiêng cay"
          description: Phương pháp điều trị
        medicines:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                example: "Paracetamol"
              type:
                type: string
                example: "Giảm đau"
              dosage:
                type: string
                example: "500mg"
              frequency:
                type: string
                example: "3 lần/ngày"
              timingInstructions:
                type: string
                example: "Sau ăn 30 phút"
              duration:
                type: string
                example: "7 ngày"
              instructions:
                type: string
                example: "Uống đủ liều, không bỏ"
          description: Danh sách thuốc kê đơn
        notes:
          type: string
          example: "Tái khám sau 1 tuần"
          description: Ghi chú thêm
        pictures:
          type: array
          items:
            type: string
          example: ["url1.jpg", "url2.jpg"]
          description: Hình ảnh kèm theo
        packageId:
          type: object
          properties:
            _id:
              type: string
              example: "60d5ecb8b392e1b8c8f5c126"
            name:
              type: string
              example: "Gói khám sức khỏe cơ bản"
            price:
              type: number
              example: 500000
        serviceId:
          type: object
          properties:
            _id:
              type: string
              example: "60d5ecb8b392e1b8c8f5c127"
            serviceName:
              type: string
              example: "Khám tổng quát"
            price:
              type: number
              example: 300000
            serviceType:
              type: string
              example: "consultation"
        slotId:
          type: string
          example: "60d5ecb8b392e1b8c8f5c128"
        appointmentDate:
          type: string
          format: date
          example: "2023-06-15"
        appointmentTime:
          type: string
          example: "14:30"
        appointmentType:
          type: string
          enum: [consultation, test, other]
          example: "consultation"
        typeLocation:
          type: string
          enum: [clinic, home, Online]
          example: "clinic"
        address:
          type: string
          example: "123 Đường ABC, Quận 1, TP.HCM"
        description:
          type: string
          example: "Khám sức khỏe định kỳ"
        notes:
          type: string
          example: "Tôi có tiền sử bệnh tim"
        status:
          type: string
          enum: [pending, confirmed, completed, cancelled]
          example: "pending"
        createdAt:
          type: string
          format: date-time
          example: "2023-06-10T07:30:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2023-06-10T07:30:00Z"


    Doctor:
      type: object
      properties:
        userId:
          type: string
        bio:
          type: string
        experience:
          type: number
        rating:
          type: number
        specialization:
          type: string
        education:
          type: string
        certificate:
          type: string

    Service:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        price:
          type: number
        description:
          type: string
        image:
          type: string
          description: URL hình ảnh dịch vụ
          example: "https://example.com/service-image.jpg"
        type:
          type: string
        availableAt:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Medicine:
      type: object
      properties:
        _id:
          type: string
          example: "675e4bcd6dc1234567890456"
          description: ID thuốc
        name:
          type: string
          example: "Paracetamol"
          description: Tên thuốc
        type:
          type: string
          example: "Giảm đau, hạ sốt"
          description: Loại thuốc
        description:
          type: string
          example: "Thuốc giảm đau, hạ sốt thông dụng"
          description: Mô tả thuốc
        defaultDosage:
          type: string
          example: "500mg"
          description: Liều lượng mặc định
        defaultTimingInstructions:
          type: string
          example: "Sau ăn 30 phút"
          description: Hướng dẫn sử dụng mặc định
        isActive:
          type: boolean
          example: true
          description: Trạng thái hoạt động
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    MedicationReminder:
      type: object
      properties:
        _id:
          type: string
          example: "675e4bcd6dc1234567890789"
          description: ID nhắc nhở
        createdByUserId:
          type: string
          example: "675e4bcd6dc1234567890abc"
          description: ID user tạo nhắc nhở
        profileId:
          type: object
          properties:
            _id:
              type: string
            fullName:
              type: string
              example: "Nguyễn Thị B"
            gender:
              type: string
              example: "female"
            phone:
              type: string
              example: "0987654321"
        medicalRecordId:
          type: object
          properties:
            _id:
              type: string
            diagnosis:
              type: string
              example: "Viêm dạ dày"
            treatment:
              type: string
              example: "Uống thuốc theo đơn"
            createdAt:
              type: string
              format: date-time
        medicines:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                example: "Paracetamol"
              dosage:
                type: string
                example: "500mg"
              reminderTimes:
                type: array
                items:
                  type: string
                example: ["08:00", "14:00", "20:00"]
                description: Giờ nhắc nhở
              frequency:
                type: string
                example: "daily"
                description: Tần suất
              instructions:
                type: string
                example: "Uống sau ăn"
          description: Danh sách thuốc và lịch nhắc
        startDate:
          type: string
          format: date
          example: "2024-01-20"
          description: Ngày bắt đầu nhắc
        endDate:
          type: string
          format: date
          example: "2024-01-27"
          description: Ngày kết thúc nhắc
        isActive:
          type: boolean
          example: true
          description: Trạng thái hoạt động
        notes:
          type: string
          example: "Nhắc uống thuốc theo đơn bác sĩ"
          description: Ghi chú thêm
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    NotificationDay:
      type: object
      properties:
        _id:
          type: string
          example: "675e4bcd6dc1234567890def"
          description: ID thông báo
        reminderId:
          type: object
          properties:
            _id:
              type: string
            medicines:
              type: array
              items:
                type: object
            profileId:
              type: object
              properties:
                fullName:
                  type: string
                  example: "Nguyễn Thị B"
          description: Thông tin nhắc nhở
        notificationTimes:
          type: string
          format: date-time
          example: "2024-01-20T08:00:00.000Z"
          description: Thời gian thông báo
        status:
          type: string
          enum: [pending, sent, failed, taken, skipped, snoozed]
          example: "taken"
          description: Trạng thái thông báo
        reason:
          type: string
          example: "Đã uống đúng giờ"
          description: Lý do (cho taken/skipped/snoozed)
        takenAt:
          type: string
          format: date-time
          description: Thời gian uống thuốc (nếu status = taken)
        snoozedUntil:
          type: string
          format: date-time
          description: Hoãn đến lúc (nếu status = snoozed)
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ServicePackage:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        image:
          type: string
          description: URL hình ảnh gói dịch vụ
          example: "https://example.com/package-image.jpg"
        priceBeforeDiscount:
          type: number
        price:
          type: number
        serviceIds:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
          currentPage:
          type: integer
          example: 1
          totalPages:
          type: integer
          example: 5
          totalRecords:
          type: integer
          example: 50
          limit:
          type: integer
          example: 10

    # =============== NEW SCHEMAS FOR 4 MODULES ===============
    
    MedicalRecord:
      type: object
      properties:
        _id:
          type: string
          example: "675e4bcd6dc1234567890123"
          description: ID hồ sơ khám bệnh
        doctorId:
          type: object
          properties:
            _id:
              type: string
            userId:
              type: object
              properties:
                fullName:
                  type: string
                  example: "Dr. Nguyễn Văn A"
                email:
                  type: string
        profileId:
          type: object
          properties:
            _id:
              type: string
            fullName:
              type: string
              example: "Nguyễn Thị B"
            gender:
              type: string
              example: "female"
            phone:
              type: string
              example: "0987654321"
        appointmentId:
          type: object
          properties:
            _id:
              type: string
            appointmentDate:
              type: string
              format: date
            appointmentTime:
              type: string
              example: "14:00-15:00"
            status:
              type: string
        diagnosis:
          type: string
          example: "Viêm dạ dày"
          description: Chẩn đoán bệnh
        symptoms:
          type: string
          example: "Đau bụng, buồn nôn"
          description: Triệu chứng
        treatment:
          type: string
          example: "Uống thuốc theo đơn, kiêng cay"
          description: Phương pháp điều trị
        medicines:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                example: "Paracetamol"
              type:
                type: string
                example: "Giảm đau"
              dosage:
                type: string
                example: "500mg"
              frequency:
                type: string
                example: "3 lần/ngày"
              timingInstructions:
                type: string
                example: "Sau ăn 30 phút"
              duration:
                type: string
                example: "7 ngày"
              instructions:
                type: string
                example: "Uống đủ liều, không bỏ"
          description: Danh sách thuốc kê đơn
        notes:
          type: string
          example: "Tái khám sau 1 tuần"
          description: Ghi chú thêm
        pictures:
          type: array
          items:
            type: string
          example: ["url1.jpg", "url2.jpg"]
          description: Hình ảnh kèm theo
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Medicine:
      type: object
      properties:
        _id:
          type: string
          example: "675e4bcd6dc1234567890456"
          description: ID thuốc
        name:
          type: string
          example: "Paracetamol"
          description: Tên thuốc
        type:
          type: string
          example: "Giảm đau, hạ sốt"
          description: Loại thuốc
        description:
          type: string
          example: "Thuốc giảm đau, hạ sốt thông dụng"
          description: Mô tả thuốc
        defaultDosage:
          type: string
          example: "500mg"
          description: Liều lượng mặc định
        defaultTimingInstructions:
          type: string
          example: "Sau ăn 30 phút"
          description: Hướng dẫn sử dụng mặc định
        isActive:
          type: boolean
          example: true
          description: Trạng thái hoạt động
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    MedicationReminder:
      type: object
      properties:
        _id:
          type: string
          example: "675e4bcd6dc1234567890789"
          description: ID nhắc nhở
        createdByUserId:
          type: string
          example: "675e4bcd6dc1234567890abc"
          description: ID user tạo nhắc nhở
        profileId:
          type: object
          properties:
            _id:
              type: string
            fullName:
              type: string
              example: "Nguyễn Thị B"
            gender:
              type: string
              example: "female"
            phone:
              type: string
              example: "0987654321"
        medicalRecordId:
          type: object
          properties:
            _id:
              type: string
            diagnosis:
              type: string
              example: "Viêm dạ dày"
            treatment:
              type: string
              example: "Uống thuốc theo đơn"
            createdAt:
              type: string
              format: date-time
        medicines:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                example: "Paracetamol"
              dosage:
                type: string
                example: "500mg"
              reminderTimes:
                type: array
                items:
                  type: string
                example: ["08:00", "14:00", "20:00"]
                description: Giờ nhắc nhở
              frequency:
                type: string
                example: "daily"
                description: Tần suất
              instructions:
                type: string
                example: "Uống sau ăn"
          description: Danh sách thuốc và lịch nhắc
        startDate:
          type: string
          format: date
          example: "2024-01-20"
          description: Ngày bắt đầu nhắc
        endDate:
          type: string
          format: date
          example: "2024-01-27"
          description: Ngày kết thúc nhắc
        isActive:
          type: boolean
          example: true
          description: Trạng thái hoạt động
        notes:
          type: string
          example: "Nhắc uống thuốc theo đơn bác sĩ"
          description: Ghi chú thêm
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    NotificationDay:
      type: object
      properties:
        _id:
          type: string
          example: "675e4bcd6dc1234567890def"
          description: ID thông báo
        reminderId:
          type: object
          properties:
            _id:
              type: string
            medicines:
              type: array
              items:
                type: object
            profileId:
              type: object
              properties:
                fullName:
                  type: string
                  example: "Nguyễn Thị B"
          description: Thông tin nhắc nhở
        notificationTimes:
          type: string
          format: date-time
          example: "2024-01-20T08:00:00.000Z"
          description: Thời gian thông báo
        status:
          type: string
          enum: [pending, sent, failed, taken, skipped, snoozed]
          example: "taken"
          description: Trạng thái thông báo
        reason:
          type: string
          example: "Đã uống đúng giờ"
          description: Lý do (cho taken/skipped/snoozed)
        takenAt:
          type: string
          format: date-time
          description: Thời gian uống thuốc (nếu status = taken)
        snoozedUntil:
          type: string
          format: date-time
          description: Hoãn đến lúc (nếu status = snoozed)
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
        currentPage:
          type: integer
          example: 1
        totalPages:
          type: integer
          example: 5
        totalRecords:
          type: integer
          example: 50
        limit:
          type: integer
          example: 10
        page:
          type: integer
          example: 1
        total:
          type: integer
          example: 50

    # Schemas for Test-related APIs
    TestCategory:
      type: object
      properties:
        _id:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k1"
        categoryName:
          type: string
          example: "Xét nghiệm máu tổng quát"
        description:
          type: string
          example: "Các xét nghiệm cơ bản về máu"
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    AppointmentTest:
      type: object
      properties:
        _id:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k2"
        userId:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k3"
        appointmentId:
          type: string
          example: "none"
        patientName:
          type: string
          example: "Nguyễn Văn A"
        phone:
          type: string
          example: "0987654321"
        email:
          type: string
          example: "test@example.com"
        testDate:
          type: string
          format: date
          example: "2024-01-20"
        testTime:
          type: string
          example: "08:00"
        testCategories:
          type: array
          items:
            $ref: '#/components/schemas/TestCategory'
        status:
          type: string
          enum: [pending, confirmed, in_progress, completed, cancelled]
          example: "pending"
        notes:
          type: string
          example: "Nhịn ăn 8 tiếng trước khi xét nghiệm"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TestResult:
      type: object
      properties:
        _id:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k4"
        appointmentTest:
          $ref: '#/components/schemas/AppointmentTest'
        testDate:
          type: string
          format: date
          example: "2024-01-20"
        doctorId:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k5"
        doctorNotes:
          type: string
          example: "Kết quả bình thường"
        conclusion:
          type: string
          example: "Không có bất thường"
        status:
          type: string
          enum: [pending, ready, delivered]
          example: "ready"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TestResultItem:
      type: object
      properties:
        _id:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k6"
        testResultId:
          type: string
          example: "64a1b2c3d4e5f6g7h8i9j0k4"
        testName:
          type: string
          example: "Hemoglobin"
        value:
          type: string
          example: "14.5"
        unit:
          type: string
          example: "g/dL"
        normalRange:
          type: string
          example: "12.0 - 16.0"
        isAbnormal:
          type: boolean
          example: false
        notes:
          type: string
          example: "Trong giới hạn bình thường"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
