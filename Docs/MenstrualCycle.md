Tôi muốn làm 1 bảng quản lí chu kỳ kinh nguyệt theo phương pháp Billings.  
Theo phương pháp Billings thì sẽ theo dõi 3 chu kì để đưa ra kết luận  
Mỗi chu kì sẽ là 1 tháng.

UI biểu hiện bảng chu kì này giống như 1 cái lịch nhưng chỉ biểu hiện bằng kí tự còn muốn xem chi tiết hoặc cập nhật chi tiết thì bấm vô ngày đó để làm. ( Sẽ có 2 chế độ mặc định là view và chế độ edit )

User sẽ cập nhật tình trạng cá nhân vào mỗi tối.  
Và user được cho phép hệ thống nhắc nhở mỗi tối để cập nhật tình trạng giống như “Bạn quên chưa cập nhật trạng thái ạ” vào lúc 8h tối hoặc là tắt không nhắc nhở.

Ví dụ về workflow:  
User chọn ngày.  
Tiếp theo User sẽ cung cấp thông tin vào các trường sau:

\- Nhập quan sát chất nhờn: ( Có máu, lấm tấm máu, đục, đục nhiều sợi, trong nhiều sợi, trong và âm hộ căng, dầy, ít chất tiết )

\- Nhập cảm giác: ( Ướt, dính, ẩm, khô, trơn )

Đề phòng việc người dùng phải nhập quá nhiều hoặc nhập sai.

Điểm cần lưu ý triển khai:  
Nếu người dùng chọn nhập chất nhờn là “Trong và âm hộ căng “ thì chắc chắn đó là ngày đỉnh X ( khả năng thụ thai cao nhất ) thì ngay lập tức bổ sung vào 3 ngày tiếp theo sau ngày đỉnh X là 1, 2, 3 ( màu vàng ) vì trong 3 ngày khả năng thụ thai giảm từ từ. Và ngày sau số 3 thì chắc chắn phải là khô.  
\- Ngày có đánh dấu là 1 thì là khả năng có thai là 75%, 2 là khả năng là 50%, 3 là khả năng là 20%.

\- Tiếp theo so sánh với 7 ngày trước ngày đỉnh X nếu quan sát chất nhờn là “đục” và cảm giác là “dính” hoặc “ ẩm” thì 2 ngày trước ngày X thì cũng là khả năng cao có em bé, tuần tự là 50% và 70%.  
\- Đặc biệt nếu 2 ngày sau ngày X sẽ khả năng bé trai cao, trước ngày X 2 ngày thì khả năng là bé gái cao.  
<br/>Công thức để tính ra báo cáo 1 chu kì kinh nguyệt bình thường sẽ như sau:

Ngày X : ngày đỉnh khả năng thụ thai cao  
Ngày X + 1: là 1 ngày sau ngày X.  
Ngày Y : Là 1 ngày trước ngày khi Quan sát chất nhờn là “có máu” của chu kỳ 2 của kinh nguyệt.  
Result: là kết quả làm cột mốc  
Nếu ( Ngày X + 1 ) - ngày Y = Result  
Trường hợp 1:  
\- Nếu result nằm trong khoảng từ -11 ~ -16 ( result có thể bị âm, ví dụ: ngày X+1 là ngày 14 trong tháng, còn ngày Y là 27 trong tháng nhưng lại là ngày cuối cùng của chu kỳ 1) thì đây là chu kỳ kinh nguyệt bình thường)

Trường hợp 2:

\- Nếu result nằm trong khoảng từ 11 ~ 16 ( result sẽ, ví dụ: ngày X+1 là ngày 14 trong tháng, còn ngày Y là 2 trong tháng sau nhưng lại là ngày cuối cùng của chu kỳ 1) thì đây là chu kỳ kinh nguyệt bình thường)  
Trường hợp 3:  
\- Nếu result dưới 11 thì là chu kỳ ngắn

Trường hợp 4:  
\- Nếu result trên 16 thì là chu kỳ dài  
Căn cứ vào result để dự đoán cho chu kỳ sau.  

Lưu ý:

Mỗi chu kỳ sẽ chỉ có 1 result.  
Sau khi có result của cả 3 chu kỳ thì mới tiến hành so sánh để báo kết quả chính xác về chu kỳ kinh nguyệt.  
Nếu sau ngày X mà người dùng chọn cảm giác “khô” và quan sát chất nhờn của họ không nhập là “dầy” thì là chu kì ngắn.  

Hệ thống sẽ ký hiệu sẽ biểu hiện lên table chu kỳ kinh nguyệt dựa trên validation.

Validation:  
Nếu đã “Có máu” và “Lấm tấm máu” thì chỉ đi được “ướt”.

Nếu đã “ Đục nhiều sợi” và “ Trong nhiều sợi “ thì chỉ có thể đi cùng với “ướt” hoặc “trơn”.

Nếu đã “ Đục” thì chỉ có thể đi với “Dính” hoặc “ẩm”.  
Nếu đã là “ trong và âm hộ căng “ thì chỉ được phép đi cùng với “ trơn”.

Nếu “ ít chất tiết “ thì chỉ được phép ẩm hoặc ướt.

Hiện tại database tôi có những bảng sau cho chức năng nhỏ này:  
Table Users {

&nbsp; \_id ObjectId \[pk\]

&nbsp; email String \[unique\]

&nbsp; password String

&nbsp; fullName String

&nbsp; phone String

&nbsp; avatar String

&nbsp; gender String

&nbsp; address String

&nbsp; year DateTime

&nbsp; role String // "guest", "customer", "doctor", "staff", "manager", "admin"

&nbsp; emailVerified Boolean \[default: false\]

&nbsp; isActive Boolean \[default: true\]

&nbsp; createdAt DateTime

&nbsp; updatedAt DateTime

}

Table MenstrualCycles {

&nbsp; \_id ObjectId \[pk\]

&nbsp; createdByUserId ObjectId \[ref: > Users.\_id\]

&nbsp; startDate DateTime

&nbsp; endDate DateTime

&nbsp; isCompleted Boolean \[default: false\]

&nbsp; cycleNumber Int // Thứ tự chu kỳ: 1, 2, 3...

&nbsp; result Int // X+1 - Y

&nbsp; resultType String // "normal", "short", "long"

&nbsp; peakDay DateTime // ngày X

&nbsp; createdAt DateTime

&nbsp; updatedAt DateTime

}

&nbsp;

Table CycleDays {

&nbsp; \_id ObjectId \[pk\]

&nbsp; cycleId ObjectId \[ref: > MenstrualCycles.\_id\]

&nbsp; date DateTime

&nbsp; mucusObservation String // ví dụ: "có máu", "trong và âm hộ căng"

&nbsp; feeling String // ví dụ: "trơn", "khô"

&nbsp; isPeakDay Boolean \[default: false\] // true nếu là ngày X

&nbsp; peakDayRelative Int // 0: ngày X, 1-3: sau X, -1/-2: trước X

&nbsp; fertilityProbability Int // 0-100 (% khả năng thụ thai)

&nbsp; babyGenderHint String // "nam", "nữ", null

&nbsp; isValidated Boolean \[default: true\] // false nếu sai quy tắc mucus/feeling

&nbsp; warning String // mô tả lỗi validation (nếu có)

&nbsp; isAutoGenerated Boolean \[default: false\] // true nếu do hệ thống tự tạo (sau ngày X)

&nbsp; cycleDayNumber Int // thứ tự trong chu kỳ, ví dụ ngày đầu là 1

&nbsp; notes String // ghi chú cá nhân của người dùng

&nbsp; month Int // để biểu diễn lịch tháng

&nbsp; year Int // để biểu diễn lịch năm

&nbsp; createdAt DateTime

&nbsp; updatedAt DateTime

}

Table MenstrualCycleReminders {

&nbsp; \_id ObjectId \[pk\]

&nbsp; userId ObjectId \[ref: > Users.\_id\]

&nbsp; reminderEnabled Boolean \[default: true\]

&nbsp; reminderTime String // định dạng "HH:mm", ví dụ "20:00"

&nbsp; lastNotifiedAt DateTime // thời điểm gần nhất đã gửi nhắc nhở

&nbsp; createdAt DateTime

&nbsp; updatedAt DateTime

}

Table MenstrualCycleReports {

&nbsp; \_id ObjectId \[pk\]

&nbsp; cycleId ObjectId \[ref: > MenstrualCycles.\_id\]

&nbsp; x DateTime // ngày X

&nbsp; xPlusOne DateTime // ngày sau đỉnh

&nbsp; y DateTime // ngày trước ngày có máu kế tiếp

&nbsp; result Int // X+1 - Y

&nbsp; resultType String // "normal", "short", "long"

&nbsp; predictedFertilityPhase String // mô tả dự đoán ("chu kỳ bình thường", ...)

&nbsp; possibleShortCyclePattern Boolean // true nếu phát hiện "khô" sau X mà không có "dầy"

&nbsp; createdAt DateTime

&nbsp; updatedAt DateTime

}  
Tôi thấy rằng chỉ với nhiêu đây thì khó triển khai như mong muốn.  
Tôi chưa tích hợp embed với linking cho document này dù tôi sài mongoDB. Tôi cần bạn đề xuất database thiết kế nhưu thế nào.  
Tôi cũng chưa có gì để thể hiện 1 chu kỳ trong 1 tháng ( ko biết có cần không )  

1\. Nhóm API Người Dùng (User APIs)

| API | Method | Đường dẫn | Mục đích |
| --- | --- | --- | --- |
| Đăng ký | POST | /api/users/register | Đăng ký tài khoản người dùng |
| Đăng nhập | POST | /api/users/login | Đăng nhập lấy token |
| Cập nhật hồ sơ | PUT | /api/users/profile | Cập nhật thông tin cá nhân |
| Lấy hồ sơ | GET | /api/users/profile | Lấy thông tin người dùng hiện tại |

2\. Nhóm API Chu Kỳ Kinh Nguyệt (MenstrualCycles)

| API | Method | Đường dẫn | Mục đích |
| --- | --- | --- | --- |
| Tạo chu kỳ mới | POST | /api/menstrual-cycles | Tạo chu kỳ mới cho user |
| Lấy danh sách chu kỳ | GET | /api/menstrual-cycles | Lấy các chu kỳ theo userId |
| Lấy chi tiết chu kỳ | GET | /api/menstrual-cycles/:id | Xem chi tiết chu kỳ |
| Cập nhật chu kỳ | PUT | /api/menstrual-cycles/:id | Cập nhật ngày X, result, kết luận |
| Xóa chu kỳ | DELETE | /api/menstrual-cycles/:id | Xóa chu kỳ |

3\. Nhóm API Ngày Trong Chu Kỳ (CycleDays)

| API | Method | Đường dẫn | Mục đích |
| --- | --- | --- | --- |
| Thêm nhật ký ngày mới | POST | /api/cycle-days | Ghi nhận chất nhờn + cảm giác |
| Lấy danh sách ngày theo chu kỳ | GET | /api/menstrual-cycles/:id/cycle-days | Lấy toàn bộ ngày trong chu kỳ |
| Lấy chi tiết ngày | GET | /api/cycle-days/:id | Xem chi tiết 1 ngày |
| Cập nhật ngày | PUT | /api/cycle-days/:id | Chỉnh sửa ghi chú, trạng thái |
| Xóa ngày | DELETE | /api/cycle-days/:id | Xóa ngày (nếu cần) |

4\. Nhóm API Nhắc Nhở (Reminders)

| API | Method | Đường dẫn | Mục đích |
| --- | --- | --- | --- |
| Bật/tắt nhắc nhở | PUT | /api/reminders | Enable/disable & chọn giờ nhắc |
| Lấy trạng thái nhắc nhở | GET | /api/reminders | Lấy cài đặt nhắc nhở hiện tại |
| Trigger gửi nhắc | POST | /api/reminders/notify | (cronjob dùng gọi) gửi nhắc nhở user chưa nhập dữ liệu ngày |

5\. Nhóm API Báo Cáo Chu Kỳ (Reports)

| API | Method | Đường dẫn | Mục đích |
| --- | --- | --- | --- |
| Tính toán báo cáo chu kỳ | POST | /api/reports/generate/:cycleId | Tính ngày X, Y, X+1, result |
| Lấy báo cáo theo chu kỳ | GET | /api/reports/:cycleId | Xem báo cáo chu kỳ đã sinh ra |
| So sánh 3 chu kỳ | GET | /api/reports/comparison | Tổng hợp report 3 chu kỳ cuối để kết luận |

6\. Nhóm API Logic Phân Tích và Gợi Ý (tự động điền)

| API | Method | Đường dẫn | Mục đích |
| --- | --- | --- | --- |
| Tự động đánh dấu các ngày sau ngày X | POST | /api/logic/generate-post-peak | Dựa theo ngày X đã nhập |
| Kiểm tra validation ngày nhập | POST | /api/logic/validate-day | Kiểm tra logic chất nhờn/cảm giác |
| Dự đoán giới tính thai | GET | /api/logic/gender-prediction/:cycleId | Gợi ý giới tính dựa trên vị trí quanh ngày X |